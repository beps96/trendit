Timestamp,Username,IP Address,Service Name,Operation,Resource,Allowed,Impersonator,Family,Qualifier,Delegation Token ID,Destination,Permissions,Source,Usage Type,Operation Text,url,Privilege,Query ID,Session ID,Status,Database Name,Object Type,Resource Path,Table Name
2019-11-21T21:29:11.000Z,ilicealo,10.67.59.12,impala,QUERY,bddldes:crm_01_tablero_perfil,true,,,,,,,,,"SELECT ""not"", COUNT(poliza) FROM crm_01_tablero_perfil WHERE codigo_postal IS NOT NULL AND fch_nacimiento  <> ''   UNION  SELECT ""null"", COUNT(poliza) FROM crm_01_tablero_perfil WHERE codigo_postal = ''",,SELECT,49456001295c6572:c515622500000000,e41b46372f1452b:eb18db74d344ff98,,bddldes,TABLE,,crm_01_tablero_perfil
2019-11-21T21:25:47.000Z,ilicealo,10.67.59.12,impala,QUERY,bddldes:crm_01_tablero_perfil,true,,,,,,,,,SELECT COUNT (*) FROm crm_01_tablero_perfil,,SELECT,a24dac61a1a8aad6:b934226f00000000,e41b46372f1452b:eb18db74d344ff98,,bddldes,TABLE,,crm_01_tablero_perfil
2019-11-21T21:23:11.000Z,ilicealo,10.67.59.12,impala,QUERY,bddldes:crm_01_tablero_perfil,true,,,,,,,,,"SELECT ""not"", COUNT(poliza) FROM crm_01_tablero_perfil WHERE fch_nacimiento IS NOT NULL AND fch_nacimiento  <> ''   UNION  SELECT ""null"", COUNT(poliza) FROM crm_01_tablero_perfil WHERE fch_nacimiento = ''  UNION  SELECT ""ghghgh"", COUNT(poliza) FROM crm_01_tablero_perfil WHERE fch_nacimiento = ' '  UNION  SELECT ""fdfd"", COUNT(poliza) FROM crm_01_tablero_perfil",,SELECT,af49c375c9241a73:639a39d500000000,e41b46372f1452b:eb18db74d344ff98,,bddldes,TABLE,,crm_01_tablero_perfil
2019-11-21T21:22:22.000Z,ilicealo,10.67.59.12,impala,QUERY,bddldes:crm_01_tablero_perfil,true,,,,,,,,,"SELECT ""not"", COUNT(poliza) FROM crm_01_tablero_perfil WHERE fch_nacimiento IS NOT NULL AND fch_nacimiento  <> ''   UNION  SELECT ""null"", COUNT(poliza) FROM crm_01_tablero_perfil WHERE fch_nacimiento = ''  UNION  SELECT ""ghghgh"", COUNT(poliza) FROM crm_01_tablero_perfil WHERE fch_nacimiento = ' '",,SELECT,334846caec388941:464e9d5300000000,e41b46372f1452b:eb18db74d344ff98,,bddldes,TABLE,,crm_01_tablero_perfil
2019-11-21T21:21:02.000Z,ilicealo,10.67.59.12,impala,QUERY,bddldes:crm_01_tablero_perfil,true,,,,,,,,,"SELECT ""not"", COUNT(poliza) FROM crm_01_tablero_perfil WHERE fch_nacimiento IS NOT NULL AND fch_nacimiento  <> ''   UNION  SELECT ""null"", COUNT(poliza) FROM crm_01_tablero_perfil WHERE fch_nacimiento IS NULL",,SELECT,644f3cb76dd3508c:92bba3f000000000,e41b46372f1452b:eb18db74d344ff98,,bddldes,TABLE,,crm_01_tablero_perfil
2019-11-21T21:07:42.943Z,dfeherna,10.67.59.12,hive,QUERY,:,true,,,,,,,,,select * from bddlapr.cnm_solicitud,,,,,,,DFS_DIR,/tmp/hive/dfeherna/f5b716f4-49df-471b-b550-4b82c421b126/hive_2019-11-21_15-07-42_954_1691704132055332775-2492/-mr-10000,
2019-11-21T21:07:42.943Z,dfeherna,10.67.59.12,hive,QUERY,bddlalm:alm_solicitud,true,,,,,,,,,select * from bddlapr.cnm_solicitud,,,,,,bddlalm,TABLE,/user/hive/warehouse/bddlalm.db/alm_solicitud,alm_solicitud
2019-11-21T21:07:42.943Z,dfeherna,10.67.59.12,hive,QUERY,bddlapr:cnm_solicitud,true,,,,,,,,,select * from bddlapr.cnm_solicitud,,,,,,bddlapr,VIEW,,cnm_solicitud
2019-11-21T21:01:32.000Z,imedrano,10.67.59.12,impala,QUERY,bddltrn:ktom41,true,,,,,,,,," select TCCOPERA,COUNT(1) from (  SELECT                                          CDNUMPOL, CTVRSPOL, CDOBJTP, CTSECOBJ,FECONTAB,FECAMBIO,CDCIAGRU,CDNUMREC, INRECIFR, INDEMIAN,NUAPUNTE,FEPROMEC,CDINTERC,TCCDMONE,FECMVTO,TCDOMORI,NUSECMVO,NUTRAB,FECTRAB,                                          CDPRODTE, CDPRODCO, CDESTRUP, CDRAMDGS, TCTINEGO, CDMEDPAG, INFISMOR, CLPROTI, CLPROUN, CDESTRUG, CLGESTI,CLGESUN,                                          CLFILTOM, CDFILPAG,TCTITXCT,CONCAT(TCTITXCT,TCCOPERA) AS CDOPERA, CDMCT, TCCOPERA,                                          IMPCEC01 AS IMPRNTEC,                                  /* PRIMA TECNICA */                                          IMPCEC18 AS IMPCOBRC,                                  /* IMPORTE COMISION BRUTA C*/                                          IMPCEC09 AS DESCCOME,                                  /* DESC. COMERCIAL */                                          IMPCEC03 + IMPCEC07 AS IMREPAFR,                       /* IMP. RECARGOS (PAGO FRACCIONADO Y DESC POR DOMICILIACION) */                                          IMPCEC04 AS IMDERECH,                                  /* DERECHOS */                                          IMPCEC05 AS IMIVAPRN,                                  /* IVA SOBRE PRIMA NETA */                                          IMPCEC06 AS IMIVADER,                                  /* IVA SOBRE DERECHOS */                                          IMPCEC10 AS IMGGINEX,                                  /* GASTOS DE GESTION INTERNA Y EXTERNA */                                          IMPCEC02 AS IMCESCOM,                                  /* CESION DE COMISION */                                          IMPCEC19 AS IMPRNETA,                                  /* PRIMA NETA */                                          IMPCEC20 AS IMPRITOT,                                  /* PRIMA TOTAL */                                          tsultmod,                                          'INFO' AS SISTORIG                                     FROM  bddltrn.ktom41  T                              --- MEC SEGURO DIRECTO                                     WHERE  CDCIAGRU = 'AU'                      /* CODIGO COMPANIA GRUPO */                                           AND TCTITXCT IN ('001','003')              /* TC TIPO TRANSACCION CONTABLE */                                           AND TCCOPERA IN ('004','005')  )Z group by TCCOPERA",,SELECT,c042e735227f02eb:19d28e6c00000000,ea45e81a4bdab095:6e358fa57dd055b1,,bddltrn,TABLE,,ktom41
2019-11-21T21:00:23.774Z,dfeherna,10.67.59.12,hive,QUERY,:,true,,,,,,,,,select * from bddlapr.cnm_procedimiento where id_solicitud='0091862821',,,,,,,DFS_DIR,/tmp/hive/dfeherna/f5b716f4-49df-471b-b550-4b82c421b126/hive_2019-11-21_15-00-23_787_1039410503526155584-2492/-mr-10000,
2019-11-21T21:00:23.774Z,dfeherna,10.67.59.12,hive,QUERY,bddlalm:alm_procedimiento,true,,,,,,,,,select * from bddlapr.cnm_procedimiento where id_solicitud='0091862821',,,,,,bddlalm,TABLE,/user/hive/warehouse/bddlalm.db/alm_procedimiento,alm_procedimiento
2019-11-21T21:00:23.774Z,dfeherna,10.67.59.12,hive,QUERY,bddlapr:cnm_procedimiento,true,,,,,,,,,select * from bddlapr.cnm_procedimiento where id_solicitud='0091862821',,,,,,bddlapr,VIEW,,cnm_procedimiento
2019-11-21T20:59:51.715Z,dfeherna,10.67.59.12,hive,QUERY,:,true,,,,,,,,,select * from bddlapr.cnm_solicitud where id_solicitud='0091862821',,,,,,,DFS_DIR,/tmp/hive/dfeherna/f5b716f4-49df-471b-b550-4b82c421b126/hive_2019-11-21_14-59-51_743_8798246396475150250-2492/-mr-10000,
2019-11-21T20:59:51.715Z,dfeherna,10.67.59.12,hive,QUERY,bddlalm:alm_solicitud,true,,,,,,,,,select * from bddlapr.cnm_solicitud where id_solicitud='0091862821',,,,,,bddlalm,TABLE,/user/hive/warehouse/bddlalm.db/alm_solicitud,alm_solicitud
2019-11-21T20:59:51.715Z,dfeherna,10.67.59.12,hive,QUERY,bddlapr:cnm_solicitud,true,,,,,,,,,select * from bddlapr.cnm_solicitud where id_solicitud='0091862821',,,,,,bddlapr,VIEW,,cnm_solicitud
2019-11-21T20:48:52.866Z,user_gmm,10.67.59.12,hive,QUERY,:,true,,,,,,,,,"SELECT pol_ver.cdnumpol, pol_ver.ctvrspol
FROM 
    (--Polizas con mas de una verion (Poliza-Version)
    SELECT cdnumpol, ctvrspol 
    FROM bddlcru.kcim06t m06
    JOIN 
        (--Polizas con mas de una version 
        SELECT DISTINCT cdnumpol as num_poliza
        FROM bddlcru.kcim06t 
        WHERE cdciagru = 'SA'
            AND ctvrspol > 0) pol ON
        m06.cdnumpol = pol.num_poliza) pol_ver
LEFT OUTER JOIN bddlcru.kcim18t ase ON
        ase.cdnumpol = pol_ver.cdnumpol
    AND ase.ctvrspol = pol_ver.ctvrspol
WHERE ase.cdnumpol IS NULL
LIMIT 5",,,,,,,DFS_DIR,/tmp/hive/user_gmm/2c12ff5b-f4c5-43b3-8125-5256b7aa413d/hive_2019-11-21_14-48-52_877_727676480600747660-256975/-mr-10000,
2019-11-21T20:48:52.866Z,user_gmm,10.67.59.12,hive,QUERY,bddlcru:kcim06t,true,,,,,,,,,"SELECT pol_ver.cdnumpol, pol_ver.ctvrspol
FROM 
    (--Polizas con mas de una verion (Poliza-Version)
    SELECT cdnumpol, ctvrspol 
    FROM bddlcru.kcim06t m06
    JOIN 
        (--Polizas con mas de una version 
        SELECT DISTINCT cdnumpol as num_poliza
        FROM bddlcru.kcim06t 
        WHERE cdciagru = 'SA'
            AND ctvrspol > 0) pol ON
        m06.cdnumpol = pol.num_poliza) pol_ver
LEFT OUTER JOIN bddlcru.kcim18t ase ON
        ase.cdnumpol = pol_ver.cdnumpol
    AND ase.ctvrspol = pol_ver.ctvrspol
WHERE ase.cdnumpol IS NULL
LIMIT 5",,,,,,bddlcru,TABLE,/user/hive/warehouse/bddlcru.db/kcim06t,kcim06t
2019-11-21T20:48:52.866Z,user_gmm,10.67.59.12,hive,QUERY,bddlcru:kcim18t,true,,,,,,,,,"SELECT pol_ver.cdnumpol, pol_ver.ctvrspol
FROM 
    (--Polizas con mas de una verion (Poliza-Version)
    SELECT cdnumpol, ctvrspol 
    FROM bddlcru.kcim06t m06
    JOIN 
        (--Polizas con mas de una version 
        SELECT DISTINCT cdnumpol as num_poliza
        FROM bddlcru.kcim06t 
        WHERE cdciagru = 'SA'
            AND ctvrspol > 0) pol ON
        m06.cdnumpol = pol.num_poliza) pol_ver
LEFT OUTER JOIN bddlcru.kcim18t ase ON
        ase.cdnumpol = pol_ver.cdnumpol
    AND ase.ctvrspol = pol_ver.ctvrspol
WHERE ase.cdnumpol IS NULL
LIMIT 5",,,,,,bddlcru,TABLE,/user/hive/warehouse/bddlcru.db/kcim18t,kcim18t
2019-11-21T20:48:19.000Z,user_gmm,10.67.59.12,impala,QUERY,null:null,true,,,,,,,,,GET_TABLES,,,d9490f235d29dd4f:6faede2700000000,14e494dffa7668e:8ac5077f8d6359a8,,,,,
2019-11-21T20:48:17.000Z,user_gmm,10.67.59.12,impala,QUERY,null:null,true,,,,,,,,,GET_TABLES,,,5c41ace2bcbd7962:d6f35fe300000000,14e494dffa7668e:8ac5077f8d6359a8,,,,,
2019-11-21T20:47:46.000Z,user_gmm,10.67.59.12,impala,QUERY,null:null,true,,,,,,,,,GET_TABLES,,,844fafe2b15f0b7f:1a74682800000000,14e494dffa7668e:8ac5077f8d6359a8,,,,,
2019-11-21T20:47:44.000Z,user_gmm,10.67.59.12,impala,QUERY,null:null,true,,,,,,,,,GET_SCHEMAS,,,954500e87c203384:bf50ab2600000000,14e494dffa7668e:8ac5077f8d6359a8,,,,,
2019-11-21T20:47:38.000Z,nyenzen,10.67.59.12,impala,QUERY,bddlcru:gaz0_exclusion,true,,,,,,,,,SELECT * from bddlcru.gaz0_exclusion where pol_numero = 615151,,SELECT,b94ae43633634785:28df919600000000,6d4131361ce8dcfa:7f3dd9eff7e5d9a3,"Query b94ae43633634785:28df919600000000 expired due to client inactivity (timeout is 10m)
",bddlcru,TABLE,,gaz0_exclusion
2019-11-21T20:47:06.000Z,nyenzen,10.67.59.12,impala,QUERY,null:null,true,,,,,,,,,GET_TABLES,,,68469beeb9f8cd5b:5a9cb1ec00000000,6d4131361ce8dcfa:7f3dd9eff7e5d9a3,,,,,
2019-11-21T20:47:05.000Z,nyenzen,10.67.59.12,impala,QUERY,null:null,true,,,,,,,,,GET_TABLES,,,634a9ecb3417547c:e9e67b8200000000,6d4131361ce8dcfa:7f3dd9eff7e5d9a3,,,,,
2019-11-21T20:47:03.000Z,nyenzen,10.67.59.12,impala,QUERY,null:null,true,,,,,,,,,GET_TABLES,,,dd495e40375a50db:ec9a533c00000000,6d4131361ce8dcfa:7f3dd9eff7e5d9a3,,,,,
2019-11-21T20:47:01.000Z,nyenzen,10.67.59.12,impala,QUERY,null:null,true,,,,,,,,,GET_TABLES,,,6b42a27de0bb962f:462943c100000000,6d4131361ce8dcfa:7f3dd9eff7e5d9a3,,,,,
2019-11-21T20:47:01.000Z,nyenzen,10.67.59.12,impala,QUERY,null:null,true,,,,,,,,,GET_TABLES,,,4f4aa30f883c5fe5:d8f8811f00000000,6d4131361ce8dcfa:7f3dd9eff7e5d9a3,,,,,
2019-11-21T20:46:52.000Z,nyenzen,10.67.59.12,impala,QUERY,null:null,true,,,,,,,,,GET_TABLES,,,f744d2540e447db7:1e280f7b00000000,6d4131361ce8dcfa:7f3dd9eff7e5d9a3,,,,,
2019-11-21T20:46:51.000Z,nyenzen,10.67.59.12,impala,QUERY,null:null,true,,,,,,,,,GET_SCHEMAS,,,104e2b8cd4aef4e5:5a24be7200000000,6d4131361ce8dcfa:7f3dd9eff7e5d9a3,,,,,
2019-11-21T20:45:35.000Z,imedrano,10.67.59.12,impala,QUERY,bddltrn:ktom41,true,,,,,,,,,"    SELECT          CAST(E.CDNUMPOL                   AS CHAR(14)   )  AS num_poliza         ,CAST(E.CTVRSPOL                   AS INT        )  AS num_version         ,CAST(E.PRODUCTO                   AS CHAR(20)   )  AS cve_producto_venta         ,CAST(E.CDOBJTP                    AS CHAR(10)   )  AS cve_tipo_objeto         ,CAST(E.CTSECOBJ                   AS INT        )  AS consecutivo_objeto         ,CAST(E.CDNUMREC                   AS CHAR(12)   )  AS cve_recibo--ADD         ,CAST(E.CDRAMDGS                   AS CHAR(4)    )  AS cve_cobertura_contable       --,CAST(E.NUAPUNTE                   AS BIGINT     )  AS num_apunte--ADD         ,CAST(E.TCTINEGO                   AS CHAR(3)    )  AS cve_negocio_contable         ,CAST(E.CDMEDPAG                   AS CHAR(2)    )  AS cve_medio_pago       --,CAST(E.INFISMOR                   AS CHAR(1)    )  AS cve_persona_fisic_moral--ADD         ,CAST(E.CLFILTOM                   AS CHAR(10)   )  AS cod_filiacion_tomador         ,CAST(E.CDFILPAG                   AS CHAR(10)   )  AS cod_filiacion_pagador         ,CAST(E.CDMCT                      AS CHAR(10)   )  AS cve_cobertura         ,CAST(E.CDOPERA                    AS CHAR(6)    )  AS cve_operacion         ,CAST(E.TCCDMONE                   AS CHAR(3)    )  AS cve_moneda         ,CAST(E.CABECERA                   AS CHAR(2)    )  AS cabecera_de_ref_contable         ,CAST(E.CDREFCAB                   AS CHAR(10)   )  AS cve_ref_contable         ,CAST(E.TIPCAVT                    AS FLOAT      )  AS tipo_cambio       --,CAST(E.INRECIFR                   AS CHAR(1)    )  AS cve_recibo_fraccion--ADD       --,CAST(E.CLPROTI                    AS CHAR(4)    )  AS cve_tipo_ofic_productora--ADD       --,CAST(E.CLPROUN                    AS CHAR(10)   )  AS cve_unidad_ofic_productora--ADD       --,CAST(E.CDESTRUG                   AS CHAR(4)    )  AS cve_estructura_gestora--ADD       --,CAST(E.CLGESTI                    AS CHAR(4)    )  AS cve_tipo_ofic_gestora--ADD       --,CAST(E.CLGESUN                    AS CHAR(10)   )  AS cve_unidad_ofic_gestora--ADD       --,CAST(E.NUSECMVO                   AS INT        )  AS num_secuencial_movimiento--ADD       --,CAST(E.INDEMIAN                   AS CHAR(1)    )  AS ban_emision_anulacion--ADD       --,CAST(E.NUTRAB                     AS CHAR(7)    )  AS cve_trabajo--ADD       --,CAST(E.CDINTERC                   AS CHAR(10)   )  AS cve_intermediario_cobrador --ADD       --,CAST(E.CDESTRUP                   AS CHAR(4)    )  AS cve_estructura_productora--ADD         ,CAST(E.FECONTAB_FH                AS TIMESTAMP  )  AS fch_contable         ,CAST(E.EJERCICIO                  AS INT        )  AS ejercicio         ,CAST(E.PERIODO                    AS CHAR(2)    )  AS periodo         ,CAST(E.ANIOMES                    AS INT        )  AS aniomes       --,CAST(E.FECMVTO_FH                 AS TIMESTAMP  )  AS fch_movimiento       --,CAST(E.FECAMBIO_FH                AS TIMESTAMP  )  AS fch_cambio--ADD       --,CAST(E.FECTRAB_FH                 AS TIMESTAMP  )  AS fch_trabajo--ADD       --,CAST(E.FEPROMEC_FH                AS TIMESTAMP  )  AS fch_proceso_mec--ADD         ,CAST(E.IND_TIPO_PRIMA             AS CHAR(1)    )  AS ind_tipo_prima         ,CAST(E.IMPRNTEC_MOR               AS FLOAT      )  AS mto_prima_tecnica_ori         ,CAST(E.IMPRNTEC_PTC               AS FLOAT      )  AS mto_prima_tecnica_int         ,CAST(E.IMREPAFR_MOR               AS FLOAT      )  AS mto_prima_rpf_ori         ,CAST(E.IMREPAFR_PTC               AS FLOAT      )  AS mto_prima_rpf_int         ,CAST(E.IMDERECH_MOR               AS FLOAT      )  AS mto_gasto_der_pol_ori         ,CAST(E.IMDERECH_PTC               AS FLOAT      )  AS mto_gasto_der_pol_int         ,CAST(E.IMPRNETA_MOR               AS FLOAT      )  AS mto_prima_neta_ori         ,CAST(E.IMPRNETA_PTC               AS FLOAT      )  AS mto_prima_neta_int         ,CAST(E.IMIVAPRN_MOR               AS FLOAT      )  AS mto_iva_prima_neta_ori         ,CAST(E.IMIVADER_MOR               AS FLOAT      )  AS mto_iva_gasto_ori         ,CAST(E.IMIVAPRN_PTC               AS FLOAT      )  AS mto_iva_prima_neta_int         ,CAST(E.IMIVADER_PTC               AS FLOAT      )  AS mto_iva_gasto_int         ,CAST(E.IMGGINEX_MOR               AS FLOAT      )  AS mto_gasto_gestion_ori         ,CAST(E.IMGGINEX_PTC               AS FLOAT      )  AS mto_gasto_gestion_int         ,CAST(E.IMCESCOM_MOR               AS FLOAT      )  AS mto_cesion_comision_ori         ,CAST(E.IMCESCOM_PTC               AS FLOAT      )  AS mto_cesion_comision_int       --,CAST(E.IMPCOBRC_MOR               AS FLOAT      )  AS mto_comision_bruta_ori       --,CAST(E.IMPCOBRC_PCT               AS FLOAT      )  AS mto_comision_bruta_int         ,CAST(E.IMPRITOT_MOR               AS FLOAT      )  AS mto_prima_total_ori         ,CAST(E.IMPRITOT_PTC               AS FLOAT      )  AS mto_prima_total_int         ,CAST(E.ID_AJUSTE                  AS SMALLINT   )  AS id_ajuste         ,CAST(E.TSULTMOD                   AS TIMESTAMP  )  as ts_ultima_modificacion         ,CAST(E.TABORI                     AS CHAR(7)    )  AS tab_origen_prima     FROM (         SELECT             C.CDNUMPOL,             C.CTVRSPOL,             C.CDOBJTP,             C.CTSECOBJ,             C.CDNUMREC,--ADD             CONCAT(C.CDPRODTE,C.CDPRODCO) AS PRODUCTO, /* PRODUCTO  (CALCULADO PARA DLK_RES)*/             C.CDPRODTE,             C.CDPRODCO,             C.CDRAMDGS,        --   C.NUAPUNTE,--ADD             C.TCTINEGO,             C.CDMEDPAG,        --   C.INFISMOR,--ADD             C.CLFILTOM,             C.CDFILPAG,             C.TCTITXCT,             C.TCCOPERA,             C.CDMCT,             C.TCCDMONE,             C.CABECERA,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000             C.CDREFCAB,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000             C.TIPCAVT,             C.FECONTAB,             C.FECONTAB_FH,             C.EJERCICIO,             C.PERIODO,             C.DIA,             C.ANIOMES,             C.IND_TIPO_PRIMA,             C.CDOPERA,        --   C.INRECIFR,--ADD        --   C.CLPROTI,--ADD        --   C.CLPROUN,--ADD        --   C.CDESTRUG,--ADD        --   C.CLGESTI,--ADD        --   C.CLGESUN,--ADD        --   C.FECMVTO_FH,--ADD        --   C.FECAMBIO_FH,--ADD        --   C.FECTRAB_FH,--ADD        --   C.FEPROMEC_FH,--ADD        --   C.TCDOMORI,--ADD        --   C.NUSECMVO,--ADD--ADD        --   C.INDEMIAN,--ADD--ADD        --   C.NUTRAB,--ADD--ADD        --   C.CDINTERC,--ADD--ADD        --   C.CDESTRUP,--ADD             SUM(C.IMPRNTEC) AS IMPRNTEC_MOR,             SUM(C.DESCCOME) AS DESCCOME_MOR,             SUM(C.IMREPAFR) AS IMREPAFR_MOR,             SUM(C.IMDERECH) AS IMDERECH_MOR,             SUM(C.IMIVAPRN) AS IMIVAPRN_MOR,             SUM(C.IMIVADER) AS IMIVADER_MOR,             SUM(C.IMGGINEX) AS IMGGINEX_MOR,             SUM(C.IMCESCOM) AS IMCESCOM_MOR,             SUM(C.IMPRNETA) AS IMPRNETA_MOR,             SUM(C.IMPRITOT) AS IMPRITOT_MOR,             SUM(C.IMPCOBRC) AS IMPCOBRC_MOR,             SUM(C.IMPRNTEC * C.TIPCAVT) AS IMPRNTEC_PTC,             SUM(C.DESCCOME * C.TIPCAVT) AS DESCCOME_PTC,             SUM(C.IMREPAFR * C.TIPCAVT) AS IMREPAFR_PTC,             SUM(C.IMDERECH * C.TIPCAVT) AS IMDERECH_PTC,             SUM(C.IMIVAPRN * C.TIPCAVT) AS IMIVAPRN_PTC,             SUM(C.IMIVADER * C.TIPCAVT) AS IMIVADER_PTC,             SUM(C.IMGGINEX * C.TIPCAVT) AS IMGGINEX_PTC,             SUM(C.IMCESCOM * C.TIPCAVT) AS IMCESCOM_PTC,             SUM(C.IMPRNETA * C.TIPCAVT) AS IMPRNETA_PTC,             SUM(C.IMPRITOT * C.TIPCAVT) AS IMPRITOT_PTC,             SUM(C.IMPCOBRC * C.TIPCAVT) AS IMPCOBRC_PTC,             MAX(C.ID_AJUSTE) AS ID_AJUSTE,             MAX(C.tsultmod)  AS TSULTMOD,--ADD             C.TABORI,             C.SISTORIG         FROM (             SELECT                 B.CDNUMPOL,                 B.CTVRSPOL,                 B.CDOBJTP,                 B.CTSECOBJ,                 B.CDNUMREC,                 B.CDPRODTE,                 B.CDPRODCO,                 B.CDRAMDGS,             --  B.NUAPUNTE,                 B.TCTINEGO,                 B.CDMEDPAG,             --  B.INFISMOR,                 B.CLFILTOM,                 B.CDFILPAG,                 B.TCTITXCT,                 B.TCCOPERA,                 B.CDMCT,                 B.TCCDMONE,                 CASE B.TCCDMONE                     WHEN 'MXP'                     THEN 1                     ELSE                         CASE                             WHEN TC.VATIPCAV IS NOT NULL                             THEN TC.VATIPCAV                             ELSE                                  CASE                                      WHEN TC2.VATIPCAV IS NOT NULL                                      THEN TC2.VATIPCAV                                      ELSE                                         CASE                                             WHEN TC3.VATIPCAV IS NOT NULL                                             THEN TC3.VATIPCAV                                             ELSE                                                 CASE                                                     WHEN TC4.VATIPCAV IS NOT NULL                                                     THEN TC4.VATIPCAV                                                     ELSE                                                         CASE                                                             WHEN TC5.VATIPCAV IS NOT NULL                                                             THEN TC5.VATIPCAV                                                             ELSE NULL                                                         END                                                 END                                         END                                 END                         END                 END AS TIPCAVT,                 CASE B.TCCDMONE                     WHEN 'MXP'                     THEN 1                     ELSE                         CASE                             WHEN TC.VATIPCAV IS NOT NULL                             THEN 2                             ELSE                                  CASE                                      WHEN TC2.VATIPCAV IS NOT NULL                                      THEN 3                                      ELSE                                         CASE                                             WHEN TC3.VATIPCAV IS NOT NULL                                             THEN 4                                             ELSE                                                 CASE                                                     WHEN TC4.VATIPCAV IS NOT NULL                                                     THEN 5                                                     ELSE                                                         CASE                                                             WHEN TC5.VATIPCAV IS NOT NULL                                                             THEN 6                                                             ELSE 0                                                         END                                                 END                                         END                                  END                         END                 END AS ID_AJUSTE,                 B.FECONTAB,                 B.FECONTAB_FH,                 CAST(SUBSTR(CAST (FECONTAB AS STRING),1,4) AS INTEGER) AS EJERCICIO,                 SUBSTR(CAST (FECONTAB AS STRING),5,2) AS PERIODO,                 CAST(SUBSTR(CAST (FECONTAB AS STRING),7,2) AS INT) AS DIA,                 CAST(SUBSTR(CAST (FECONTAB AS STRING),1,6) AS INT) AS ANIOMES,                 B.IND_TIPO_PRIMA,                 B.CABECERA,   ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000                 B.CDREFCAB,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000                 B.CDOPERA,             --  B.INRECIFR,             --  B.CLPROTI,             --  B.CLPROUN,             --  B.CDESTRUG,             --  B.CLGESTI,             --  B.CLGESUN,             --  B.FECMVTO_FH,             --  B.FECAMBIO_FH,             --  B.FECTRAB_FH,             --  B.FEPROMEC_FH,             --  B.TCDOMORI,             --  B.NUSECMVO,             --  B.INDEMIAN,             --  B.NUTRAB,             --  B.CDINTERC,             --  B.CDESTRUP,                 B.IMPRNTEC,                 B.DESCCOME,                 B.IMREPAFR,                 B.IMDERECH,                 B.IMIVAPRN,                 B.IMIVADER,                 B.IMGGINEX,                 B.IMCESCOM,                 B.IMPRNETA,                 B.IMPCOBRC,                 B.IMPRITOT,                 B.TABORI,                 B.tsultmod,--ADD                 B.SISTORIG             FROM (---inicio B                 SELECT                     A.CDNUMPOL,                     A.CTVRSPOL,                     A.CDOBJTP,                     A.CTSECOBJ,                     A.CDNUMREC,                     A.CDPRODTE,                     A.CDPRODCO,                     A.CDRAMDGS,                  -- A.NUAPUNTE,                     A.TCTINEGO,                     A.CDMEDPAG,                  -- A.INFISMOR,                     A.CLFILTOM,                     A.CDFILPAG,                     A.TCTITXCT,                     A.TCCOPERA,                     'C' AS IND_TIPO_PRIMA,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMPRNTEC                         WHEN '001005' THEN  IMPRNTEC  * -1                         WHEN '003004' THEN  IMPRNTEC  * -1                         WHEN '003005' THEN  IMPRNTEC                         ELSE 0                      END AS  IMPRNTEC,                     CASE A.CDOPERA                         WHEN '001004' THEN  DESCCOME                         WHEN '001005' THEN  DESCCOME  * -1                         WHEN '003004' THEN  DESCCOME  * -1                         WHEN '003005' THEN  DESCCOME                         ELSE 0                      END AS  DESCCOME,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMREPAFR                         WHEN '001005' THEN  IMREPAFR  * -1                         WHEN '003004' THEN  IMREPAFR  * -1                         WHEN '003005' THEN  IMREPAFR                            ELSE 0                      END AS  IMREPAFR,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMDERECH                         WHEN '001005' THEN  IMDERECH  * -1                         WHEN '003004' THEN  IMDERECH  * -1                         WHEN '003005' THEN  IMDERECH                            ELSE 0                      END AS  IMDERECH,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMIVAPRN                         WHEN '001005' THEN  IMIVAPRN  * -1                         WHEN '003004' THEN  IMIVAPRN  * -1                         WHEN '003005' THEN  IMIVAPRN                            ELSE 0                      END AS  IMIVAPRN,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMIVADER                         WHEN '001005' THEN  IMIVADER  * -1                         WHEN '003004' THEN  IMIVADER  * -1                         WHEN '003005' THEN  IMIVADER                            ELSE 0                      END AS  IMIVADER,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMGGINEX                         WHEN '001005' THEN  IMGGINEX  * -1                         WHEN '003004' THEN  IMGGINEX  * -1                         WHEN '003005' THEN  IMGGINEX                            ELSE 0                      END AS  IMGGINEX,                      CASE A.CDOPERA                         WHEN '001004' THEN  IMCESCOM                         WHEN '001005' THEN  IMCESCOM  * -1                         WHEN '003004' THEN  IMCESCOM  * -1                         WHEN '003005' THEN  IMCESCOM                            ELSE 0                      END AS  IMCESCOM,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMPRNETA                         WHEN '001005' THEN  IMPRNETA  * -1                         WHEN '003004' THEN  IMPRNETA  * -1                         WHEN '003005' THEN  IMPRNETA                            ELSE 0                      END AS  IMPRNETA,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMPCOBRC                         WHEN '001005' THEN  IMPCOBRC  * -1                         WHEN '003004' THEN  IMPCOBRC  * -1                         WHEN '003005' THEN  IMPCOBRC                            ELSE 0                      END AS  IMPCOBRC,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMPRITOT                         WHEN '001005' THEN  IMPRITOT  * -1                         WHEN '003004' THEN  IMPRITOT  * -1                         WHEN '003005' THEN  IMPRITOT                            ELSE 0                      END AS  IMPRITOT,                     A.TCCDMONE,                     A.FECONTAB,                     A.FECONTAB_FH,                     A2.CABECERA,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000                     A2.CDREFCAB,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000                     A.CDMCT,                     A.CDOPERA,                  -- A.INRECIFR,                  -- A.CLPROTI,                  -- A.CLPROUN,                  -- A.CDESTRUG,                  -- A.CLGESTI,                  -- A.CLGESUN,                  -- A.TCDOMORI,                  -- CAST(CONCAT(SUBSTR(CAST (A.FECMVTO AS STRING),1,4),'-',SUBSTR(CAST (A.FECMVTO AS STRING),5,2),'-',SUBSTR(CAST (A.FECMVTO AS STRING),7,2)) AS TIMESTAMP) as FECMVTO_FH,                  -- CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP) as FECAMBIO_FH,                  -- CAST(CONCAT(SUBSTR(CAST (A.FECTRAB AS STRING),1,4),'-',SUBSTR(CAST (A.FECTRAB AS STRING),5,2),'-',SUBSTR(CAST (A.FECTRAB AS STRING),7,2)) AS TIMESTAMP) as FECTRAB_FH,                  -- CAST(CONCAT(SUBSTR(CAST (A.FEPROMEC AS STRING),1,4),'-',SUBSTR(CAST (A.FEPROMEC AS STRING),5,2),'-',SUBSTR(CAST (A.FEPROMEC AS STRING),7,2)) AS TIMESTAMP) as FEPROMEC_FH,                  -- A.NUSECMVO,                  -- A.INDEMIAN,                  -- A.NUTRAB,                  -- A.CDINTERC,                  -- A.CDESTRUP,                     'KTOM41' AS TABORI,                     A.tsultmod,                     A.SISTORIG                     FROM (                             SELECT                                 CDNUMPOL, CTVRSPOL, CDOBJTP, CTSECOBJ, FECONTAB,FECAMBIO,CDCIAGRU, CDNUMREC, INRECIFR, INDEMIAN,NUAPUNTE,FEPROMEC, CDINTERC, TCCDMONE, FECMVTO, TCDOMORI, NUSECMVO, NUTRAB,FECTRAB,                                 CAST(CONCAT(SUBSTR(CAST (FECONTAB AS STRING),1,4),'-',SUBSTR(CAST (FECONTAB AS STRING),5,2),'-',SUBSTR(CAST (FECONTAB AS STRING),7,2)) AS TIMESTAMP) AS FECONTAB_FH,                                 CDPRODTE, CDPRODCO, CDESTRUP, CDRAMDGS, TCTINEGO, CDMEDPAG, INFISMOR, CLPROTI, CLPROUN, CDESTRUG, CLGESTI, CLGESUN,                                 CLFILTOM, CDFILPAG,TCTITXCT,CDOPERA, CDMCT,TCCOPERA,                                 sum(IMPRNTEC) as IMPRNTEC,                      /* PRIMA TECNICA */                                 sum(DESCCOME) as DESCCOME,                      /* DESC. COMERCIAL */                                 sum(IMREPAFR) as IMREPAFR,                      /* RECARGO PAGO FRACCIONADO (Y DESC POR DOMICILIACION) */                                 sum(IMDERECH) as IMDERECH,                      /* DERECHOS */                                 sum(IMIVAPRN) as IMIVAPRN,                      /* IVA SOBRE PRIMA NETA */                                 sum(IMIVADER) as IMIVADER,                      /* IVA SOBRE DERECHOS */                                 sum(IMGGINEX) as IMGGINEX,                      /* GASTOS DE GESTION INTERNA Y EXTERNA */                                 sum(IMCESCOM) as IMCESCOM,                      /* CESION DE COMISION */                                 sum(IMPRNETA) as IMPRNETA,                      /* PRIMA NETA */                                 sum(IMPRITOT) as IMPRITOT,                      /* PRIMA TOTAL */                                 sum(IMPCOBRC) as IMPCOBRC,                      /* IMPORTE COMISION BRUTA C*/                                 MAX(tsultmod) as tsultmod,                                 SISTORIG                             FROM (                                     SELECT                                          CDNUMPOL, CTVRSPOL, CDOBJTP, CTSECOBJ,FECONTAB,FECAMBIO,CDCIAGRU,CDNUMREC, INRECIFR, INDEMIAN,NUAPUNTE,FEPROMEC,CDINTERC,TCCDMONE,FECMVTO,TCDOMORI,NUSECMVO,NUTRAB,FECTRAB,                                          CDPRODTE, CDPRODCO, CDESTRUP, CDRAMDGS, TCTINEGO, CDMEDPAG, INFISMOR, CLPROTI, CLPROUN, CDESTRUG, CLGESTI,CLGESUN,                                          CLFILTOM, CDFILPAG,TCTITXCT,CONCAT(TCTITXCT,TCCOPERA) AS CDOPERA, CDMCT, TCCOPERA,                                          IMPCEC01 AS IMPRNTEC,                                  /* PRIMA TECNICA */                                          IMPCEC18 AS IMPCOBRC,                                  /* IMPORTE COMISION BRUTA C*/                                          IMPCEC09 AS DESCCOME,                                  /* DESC. COMERCIAL */                                          IMPCEC03 + IMPCEC07 AS IMREPAFR,                       /* IMP. RECARGOS (PAGO FRACCIONADO Y DESC POR DOMICILIACION) */                                          IMPCEC04 AS IMDERECH,                                  /* DERECHOS */                                          IMPCEC05 AS IMIVAPRN,                                  /* IVA SOBRE PRIMA NETA */                                          IMPCEC06 AS IMIVADER,                                  /* IVA SOBRE DERECHOS */                                          IMPCEC10 AS IMGGINEX,                                  /* GASTOS DE GESTION INTERNA Y EXTERNA */                                          IMPCEC02 AS IMCESCOM,                                  /* CESION DE COMISION */                                          IMPCEC19 AS IMPRNETA,                                  /* PRIMA NETA */                                          IMPCEC20 AS IMPRITOT,                                  /* PRIMA TOTAL */                                          tsultmod,                                          'INFO' AS SISTORIG                                     FROM  bddltrn.ktom41  T                              --- MEC SEGURO DIRECTO                                     WHERE  CDCIAGRU = 'AU'                      /* CODIGO COMPANIA GRUPO */                                           AND TCTITXCT IN ('001','003')              /* TC TIPO TRANSACCION CONTABLE */                                           AND TCCOPERA IN ('004','005')    /* TC CODIGO OPERACION CONTABLE (SEGUN IBM AUNQUE EN REALIDAD NO SE APRECIA QUE OCURRAN EN AUTOS LOS TCCOPERA '002' Y '006') */                                     ----- Muesta de ejemplo ---------------------------------------------------------------------------------                                           and CDNUMPOL in (                                                                  '00000206050452', '00000197538226', '00000188949903', '00000228274726', '00000161422936',                                                                '00000152877981','00000220400931','00000220999841'                                            )                                     --------------------------------------------------------------------------------------------------------                                 ) PRP                             GROUP BY                                 CDNUMPOL, CTVRSPOL, CDOBJTP, CTSECOBJ, FECONTAB,FECAMBIO, CDCIAGRU, CDNUMREC, INRECIFR, INDEMIAN,NUAPUNTE,FEPROMEC, CDINTERC, TCCDMONE, FECMVTO, TCDOMORI, NUSECMVO, NUTRAB, FECTRAB,                                 CDPRODTE, CDPRODCO, CDESTRUP, CDRAMDGS, TCTINEGO, CDMEDPAG, INFISMOR, CLPROTI, CLPROUN, CDESTRUG, CLGESTI, CLGESUN,                                 CLFILTOM, CDFILPAG,TCTITXCT,CDOPERA, CDMCT, TCCOPERA,SISTORIG                     ) A                     LEFT OUTER JOIN (                             SELECT                                 CDNUMPOL, CTVRSPOL, CDCIAGRU,  FECONTAB, NUSECMVO, NUTRAB, CDNUMREC, INRECIFR, INDEMIAN, FEPRECON,                                 TCCDMONE, FEPROMEC, CDINTERC, FECMVTO, FECTRAB, CDREFCAB, SUBSTR(TRIM(CDREFCAB),1,2) AS CABECERA    ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000                             FROM (--Se adiciono el query para quitar duplicados en CDREFCAB                                     select                                          PARC.CDNUMPOL,PARC.CTVRSPOL,PARC.CDCIAGRU,PARC.FECONTAB,PARC.NUSECMVO,PARC.NUTRAB,PARC.CDNUMREC,PARC.INRECIFR,PARC.FEPRECON,PARC.INDEMIAN,                                         PARC.TCCDMONE,PARC.FEPROMEC,PARC.CDINTERC,PARC.FECMVTO,PARC.FECTRAB,PARC.CDREFCAB, SUBSTR(TRIM(PARC.CDREFCAB),1,2) AS CABECERA,                                         PARC.fechaaud                                     from                                           (                                             SELECT                                                 CDNUMPOL, CTVRSPOL, CDCIAGRU,  FECONTAB, NUSECMVO, NUTRAB, CDNUMREC, INRECIFR, FEPRECON,                                                 TCCDMONE, FEPROMEC, CDINTERC, FECMVTO, FECTRAB, CDREFCAB, SUBSTR(TRIM(CDREFCAB),1,2) AS CABECERA                                                 ,fechaaud,INDEMIAN                                             FROM bddldes.ktoa41t_union A --- MEC SEGURO DIRECTO                                             WHERE  CDCIAGRU = 'AU'                                          )PARC                                         LEFT OUTER JOIN                                         (                                              SELECT                                                  CDNUMREC,CDNUMPOL,CTVRSPOL,FECONTAB,FECMVTO,NUSECMVO,CDINTERC,TCCDMONE,NUTRAB,FECTRAB,INRECIFR,                                                  INDEMIAN, MAX(fechaaud) AS fechaaud                                              FROM bddldes.ktoa41t_union A                                              GROUP BY                                                     CDNUMREC,CDNUMPOL,CTVRSPOL,FECONTAB,FECMVTO,NUSECMVO,CDINTERC,TCCDMONE,NUTRAB,                                                   FECTRAB,INRECIFR,INDEMIAN                                         )PARC2                                         ON(PARC.CDNUMREC = PARC2.CDNUMREC  AND                                             PARC.CDNUMPOL = PARC2.CDNUMPOL  AND                                              PARC.CTVRSPOL = PARC2.CTVRSPOL AND                                            PARC.FECONTAB = PARC2.FECONTAB  AND                                            PARC.FECMVTO  = PARC2.FECMVTO   AND                                                PARC.NUSECMVO = PARC2.NUSECMVO  AND                                             PARC.CDINTERC = PARC2.CDINTERC  AND                                               PARC.TCCDMONE = PARC2.TCCDMONE  AND                                             PARC.NUTRAB   = PARC2.NUTRAB    AND                                                PARC.FECTRAB  = PARC2.FECTRAB   AND                                               PARC.INRECIFR = PARC2.INRECIFR  AND                                             PARC.INDEMIAN = PARC2.INDEMIAN  AND                                            PARC.fechaaud = PARC2.fechaaud                                         )                                     WHERE PARC2.fechaaud IS NOT NULL                      /* CODIGO COMPANIA GRUPO */                                 ) CABPRP                             GROUP BY                                 CDNUMPOL, CTVRSPOL, CDCIAGRU,  FECONTAB, NUSECMVO, NUTRAB, CDNUMREC, INRECIFR, INDEMIAN, FEPRECON,                                 TCCDMONE, FEPROMEC, CDINTERC, FECMVTO, FECTRAB, CDREFCAB,  SUBSTR(TRIM(CDREFCAB),7,2)                     ) A2                     ON ( TRIM(A.CDCIAGRU)  = TRIM(A2.CDCIAGRU) AND                         A.CDNUMREC  = A2.CDNUMREC AND                         A.CDNUMPOL  = A2.CDNUMPOL AND                         A.CTVRSPOL  = A2.CTVRSPOL AND                         A.FECONTAB  = A2.FECONTAB AND                         A.FECMVTO   = A2.FECMVTO  AND                         A.NUSECMVO  = A2.NUSECMVO AND                         A.CDINTERC  = A2.CDINTERC AND                         A.TCCDMONE  = A2.TCCDMONE AND                         A.NUTRAB    = A2.NUTRAB   AND                         A.FECTRAB   = A2.FECTRAB  AND                         A.INRECIFR  = A2.INRECIFR AND                         A.INDEMIAN  = A2.INDEMIAN                         )             ) B              -- TIPO DE CAMBIO             LEFT OUTER JOIN (                             SELECT DISTINCT A.CDDIVDES, A.CDDIVORI, A.FECAMBIO, A.VATIPCAV,                                      CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP ) AS FECAMBIO_FCH                                      FROM BDDLCRU.KTOTCAT A                                      INNER JOIN                                      (                                      SELECT CDDIVDES, CDDIVORI, MAX(CTVRSCAM) AS MAX_CTVRSCAM, FECAMBIO                                      FROM BDDLCRU.KTOTCAT GROUP BY CDDIVDES, CDDIVORI, FECAMBIO                                      ) B                                      ON (A.CDDIVDES = B.CDDIVDES AND A.CTVRSCAM = B.MAX_CTVRSCAM                                         AND  A.CDDIVORI = B.CDDIVORI AND A.FECAMBIO = B.FECAMBIO)                                      WHERE A.FECAMBIO > 0             ) TC             ON (TC.CDDIVORI = B.TCCDMONE AND TC.FECAMBIO_FCH = B.FECONTAB_FH)             LEFT OUTER JOIN (                              SELECT DISTINCT A.CDDIVDES, A.CDDIVORI, A.FECAMBIO, A.VATIPCAV,                                      CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP ) AS FECAMBIO_FCH                                      FROM BDDLCRU.KTOTCAT A                                      INNER JOIN                                      (                                      SELECT CDDIVDES, CDDIVORI, MAX(CTVRSCAM) AS MAX_CTVRSCAM, FECAMBIO                                      FROM BDDLCRU.KTOTCAT GROUP BY CDDIVDES, CDDIVORI, FECAMBIO                                      ) B                                      ON (A.CDDIVDES = B.CDDIVDES AND A.CTVRSCAM = B.MAX_CTVRSCAM                                         AND  A.CDDIVORI = B.CDDIVORI AND A.FECAMBIO = B.FECAMBIO)                                      WHERE A.FECAMBIO > 0             ) TC2             ON (TC2.CDDIVORI = B.TCCDMONE AND TC2.FECAMBIO_FCH = DAYS_SUB(B.FECONTAB_FH,1))             --ON (TC2.CDDIVORI = B.TCCDMONE AND TC2.FECAMBIO_FCH =  (FECONTAB_FH-1 DAY))             LEFT OUTER JOIN (                              SELECT DISTINCT A.CDDIVDES, A.CDDIVORI, A.FECAMBIO, A.VATIPCAV,                                      CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP ) AS FECAMBIO_FCH                                      FROM BDDLCRU.KTOTCAT A                                      INNER JOIN                                      (                                      SELECT CDDIVDES, CDDIVORI, MAX(CTVRSCAM) AS MAX_CTVRSCAM, FECAMBIO                                      FROM BDDLCRU.KTOTCAT GROUP BY CDDIVDES, CDDIVORI, FECAMBIO                                      ) B                                  ",,,,,,,,,
   ON (A.CDDIVDES = B.CDDIVDES AND A.CTVRSCAM = B.MAX_CTVRSCAM,,,,,,,,,,,,,,,,,,,,,,,,
                                         AND  A.CDDIVORI = B.CDDIVORI AND A.FECAMBIO = B.FECAMBIO),,,,,,,,,,,,,,,,,,,,,,,,
                                      WHERE A.FECAMBIO > 0,,,,,,,,,,,,,,,,,,,,,,,,
             ) TC3,,,,,,,,,,,,,,,,,,,,,,,,
             ON (TC3.CDDIVORI = B.TCCDMONE AND TC3.FECAMBIO_FCH = DAYS_SUB(B.FECONTAB_FH,2)),,,,,,,,,,,,,,,,,,,,,,,
           --  ON (TC3.CDDIVORI = B.TCCDMONE AND TC3.FECAMBIO_FCH = (FECONTAB_FH-2 DAY)),,,,,,,,,,,,,,,,,,,,,,,,
             LEFT OUTER JOIN (,,,,,,,,,,,,,,,,,,,,,,,,
                              SELECT DISTINCT A.CDDIVDES, A.CDDIVORI, A.FECAMBIO, A.VATIPCAV,,,,,,,,,,,,,,,,,,,,,
                                      CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP ) AS FECAMBIO_FCH,,,,,,,,,,,,,,
                                      FROM BDDLCRU.KTOTCAT A,,,,,,,,,,,,,,,,,,,,,,,,
                                      INNER JOIN,,,,,,,,,,,,,,,,,,,,,,,,
                                      (,,,,,,,,,,,,,,,,,,,,,,,,
                                      SELECT CDDIVDES, CDDIVORI, MAX(CTVRSCAM) AS MAX_CTVRSCAM, FECAMBIO,,,,,,,,,,,,,,,,,,,,,
                                      FROM BDDLCRU.KTOTCAT GROUP BY CDDIVDES, CDDIVORI, FECAMBIO,,,,,,,,,,,,,,,,,,,,,,
                                      ) B,,,,,,,,,,,,,,,,,,,,,,,,
                                      ON (A.CDDIVDES = B.CDDIVDES AND A.CTVRSCAM = B.MAX_CTVRSCAM,,,,,,,,,,,,,,,,,,,,,,,,
                                         AND  A.CDDIVORI = B.CDDIVORI AND A.FECAMBIO = B.FECAMBIO),,,,,,,,,,,,,,,,,,,,,,,,
                                      WHERE A.FECAMBIO > 0,,,,,,,,,,,,,,,,,,,,,,,,
             ) TC4,,,,,,,,,,,,,,,,,,,,,,,,
             ON (TC4.CDDIVORI = B.TCCDMONE AND TC4.FECAMBIO_FCH = DAYS_SUB(B.FECONTAB_FH,3)),,,,,,,,,,,,,,,,,,,,,,,
           --  ON (TC4.CDDIVORI = B.TCCDMONE AND TC4.FECAMBIO_FCH = (FECONTAB_FH-3 DAY)),,,,,,,,,,,,,,,,,,,,,,,,
             LEFT OUTER JOIN (,,,,,,,,,,,,,,,,,,,,,,,,
                              SELECT DISTINCT A.CDDIVDES, A.CDDIVORI, A.FECAMBIO, A.VATIPCAV,,,,,,,,,,,,,,,,,,,,,
                                      CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP ) AS FECAMBIO_FCH,,,,,,,,,,,,,,
                                      FROM BDDLCRU.KTOTCAT A,,,,,,,,,,,,,,,,,,,,,,,,
                                      INNER JOIN,,,,,,,,,,,,,,,,,,,,,,,,
                                      (,,,,,,,,,,,,,,,,,,,,,,,,
                                      SELECT CDDIVDES, CDDIVORI, MAX(CTVRSCAM) AS MAX_CTVRSCAM, FECAMBIO,,,,,,,,,,,,,,,,,,,,,
                                      FROM BDDLCRU.KTOTCAT GROUP BY CDDIVDES, CDDIVORI, FECAMBIO,,,,,,,,,,,,,,,,,,,,,,
                                      ) B,,,,,,,,,,,,,,,,,,,,,,,,
                                      ON (A.CDDIVDES = B.CDDIVDES AND A.CTVRSCAM = B.MAX_CTVRSCAM,,,,,,,,,,,,,,,,,,,,,,,,
                                         AND  A.CDDIVORI = B.CDDIVORI AND A.FECAMBIO = B.FECAMBIO),,,,,,,,,,,,,,,,,,,,,,,,
                                      WHERE A.FECAMBIO > 0,,,,,,,,,,,,,,,,,,,,,,,,
             ) TC5,,,,,,,,,,,,,,,,,,,,,,,,
             ON (TC5.CDDIVORI = B.TCCDMONE AND TC5.FECAMBIO_FCH = DAYS_SUB(B.FECONTAB_FH,4)),,,,,,,,,,,,,,,,,,,,,,,
           --  ON (TC5.CDDIVORI = B.TCCDMONE AND TC5.FECAMBIO_FCH = (FECONTAB_FH-4 DAY)),,,,,,,,,,,,,,,,,,,,,,,,
             LEFT OUTER JOIN (,,,,,,,,,,,,,,,,,,,,,,,,
                              SELECT DISTINCT A.CDDIVDES, A.CDDIVORI, A.FECAMBIO, A.VATIPCAV,,,,,,,,,,,,,,,,,,,,,
                                      CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP ) AS FECAMBIO_FCH,,,,,,,,,,,,,,
                                      FROM BDDLCRU.KTOTCAT A,,,,,,,,,,,,,,,,,,,,,,,,
                                      INNER JOIN,,,,,,,,,,,,,,,,,,,,,,,,
                                      (,,,,,,,,,,,,,,,,,,,,,,,,
                                      SELECT CDDIVDES, CDDIVORI, MAX(CTVRSCAM) AS MAX_CTVRSCAM, FECAMBIO,,,,,,,,,,,,,,,,,,,,,
                                      FROM BDDLCRU.KTOTCAT GROUP BY CDDIVDES, CDDIVORI, FECAMBIO,,,,,,,,,,,,,,,,,,,,,,
                                      ) B,,,,,,,,,,,,,,,,,,,,,,,,
                                      ON (A.CDDIVDES = B.CDDIVDES AND A.CTVRSCAM = B.MAX_CTVRSCAM,,,,,,,,,,,,,,,,,,,,,,,,
                                         AND  A.CDDIVORI = B.CDDIVORI AND A.FECAMBIO = B.FECAMBIO),,,,,,,,,,,,,,,,,,,,,,,,
                                      WHERE A.FECAMBIO > 0,,,,,,,,,,,,,,,,,,,,,,,,
             ) TC6,,,,,,,,,,,,,,,,,,,,,,,,
             ON (TC6.CDDIVORI = B.TCCDMONE AND TC6.FECAMBIO_FCH = DAYS_SUB(B.FECONTAB_FH,5)),,,,,,,,,,,,,,,,,,,,,,,
         ) C,,,,,,,,,,,,,,,,,,,,,,,,
         GROUP BY,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDNUMPOL,,,,,,,,,,,,,,,,,,,,,,,,
             C.CTVRSPOL,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDOBJTP,,,,,,,,,,,,,,,,,,,,,,,,
             C.CTSECOBJ,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDNUMREC,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
             C.CDPRODTE,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDPRODCO,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDRAMDGS,,,,,,,,,,,,,,,,,,,,,,,,
          -- C.NUAPUNTE,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
             C.TCTINEGO,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDMEDPAG,,,,,,,,,,,,,,,,,,,,,,,,
          -- C.INFISMOR,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
             C.CLFILTOM,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDFILPAG,,,,,,,,,,,,,,,,,,,,,,,,
             C.TCTITXCT,,,,,,,,,,,,,,,,,,,,,,,,
             C.TCCOPERA,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDMCT,,,,,,,,,,,,,,,,,,,,,,,,
             C.TCCDMONE,,,,,,,,,,,,,,,,,,,,,,,,
             C.CABECERA,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000,,,,,,,,,,,,,,,,,,,,,,,
             C.CDREFCAB,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000,,,,,,,,,,,,,,,,,,,,,,,
             C.TIPCAVT,,,,,,,,,,,,,,,,,,,,,,,,
             C.FECONTAB,,,,,,,,,,,,,,,,,,,,,,,,
             C.FECONTAB_FH,,,,,,,,,,,,,,,,,,,,,,,,
             C.EJERCICIO,,,,,,,,,,,,,,,,,,,,,,,,
             C.PERIODO,,,,,,,,,,,,,,,,,,,,,,,,
             C.DIA,,,,,,,,,,,,,,,,,,,,,,,,
             C.ANIOMES,,,,,,,,,,,,,,,,,,,,,,,,
             C.IND_TIPO_PRIMA,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDOPERA,,,,,,,,,,,,,,,,,,,,,,,,
         --  C.INRECIFR,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CLPROTI,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CLPROUN,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CDESTRUG,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CLGESTI,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CLGESUN,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.FECMVTO_FH,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.FECAMBIO_FH,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.FECTRAB_FH,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.FEPROMEC_FH,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.TCDOMORI,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.NUSECMVO,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.INDEMIAN,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.NUTRAB,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CDINTERC,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CDESTRUP,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
             C.TABORI,,,,,,,,,,,,,,,,,,,,,,,,
             C.SISTORIG,,,,,,,,,,,,,,,,,,,,,,,,
"     ) E""",,SELECT,4e4fbeeea26cff39:b1017bca00000000,ea45e81a4bdab095:6e358fa57dd055b1,"Query 4e4fbeeea26cff39:b1017bca00000000 expired due to client inactivity (timeout is 10m)
",bddltrn,TABLE,,ktom41,,,,,,,,,,,,,,,
2019-11-21T20:45:35.000Z,imedrano,10.67.59.12,impala,QUERY,bddldes:ktoa41t_union,true,,,,,,,,,"    SELECT          CAST(E.CDNUMPOL                   AS CHAR(14)   )  AS num_poliza         ,CAST(E.CTVRSPOL                   AS INT        )  AS num_version         ,CAST(E.PRODUCTO                   AS CHAR(20)   )  AS cve_producto_venta         ,CAST(E.CDOBJTP                    AS CHAR(10)   )  AS cve_tipo_objeto         ,CAST(E.CTSECOBJ                   AS INT        )  AS consecutivo_objeto         ,CAST(E.CDNUMREC                   AS CHAR(12)   )  AS cve_recibo--ADD         ,CAST(E.CDRAMDGS                   AS CHAR(4)    )  AS cve_cobertura_contable       --,CAST(E.NUAPUNTE                   AS BIGINT     )  AS num_apunte--ADD         ,CAST(E.TCTINEGO                   AS CHAR(3)    )  AS cve_negocio_contable         ,CAST(E.CDMEDPAG                   AS CHAR(2)    )  AS cve_medio_pago       --,CAST(E.INFISMOR                   AS CHAR(1)    )  AS cve_persona_fisic_moral--ADD         ,CAST(E.CLFILTOM                   AS CHAR(10)   )  AS cod_filiacion_tomador         ,CAST(E.CDFILPAG                   AS CHAR(10)   )  AS cod_filiacion_pagador         ,CAST(E.CDMCT                      AS CHAR(10)   )  AS cve_cobertura         ,CAST(E.CDOPERA                    AS CHAR(6)    )  AS cve_operacion         ,CAST(E.TCCDMONE                   AS CHAR(3)    )  AS cve_moneda         ,CAST(E.CABECERA                   AS CHAR(2)    )  AS cabecera_de_ref_contable         ,CAST(E.CDREFCAB                   AS CHAR(10)   )  AS cve_ref_contable         ,CAST(E.TIPCAVT                    AS FLOAT      )  AS tipo_cambio       --,CAST(E.INRECIFR                   AS CHAR(1)    )  AS cve_recibo_fraccion--ADD       --,CAST(E.CLPROTI                    AS CHAR(4)    )  AS cve_tipo_ofic_productora--ADD       --,CAST(E.CLPROUN                    AS CHAR(10)   )  AS cve_unidad_ofic_productora--ADD       --,CAST(E.CDESTRUG                   AS CHAR(4)    )  AS cve_estructura_gestora--ADD       --,CAST(E.CLGESTI                    AS CHAR(4)    )  AS cve_tipo_ofic_gestora--ADD       --,CAST(E.CLGESUN                    AS CHAR(10)   )  AS cve_unidad_ofic_gestora--ADD       --,CAST(E.NUSECMVO                   AS INT        )  AS num_secuencial_movimiento--ADD       --,CAST(E.INDEMIAN                   AS CHAR(1)    )  AS ban_emision_anulacion--ADD       --,CAST(E.NUTRAB                     AS CHAR(7)    )  AS cve_trabajo--ADD       --,CAST(E.CDINTERC                   AS CHAR(10)   )  AS cve_intermediario_cobrador --ADD       --,CAST(E.CDESTRUP                   AS CHAR(4)    )  AS cve_estructura_productora--ADD         ,CAST(E.FECONTAB_FH                AS TIMESTAMP  )  AS fch_contable         ,CAST(E.EJERCICIO                  AS INT        )  AS ejercicio         ,CAST(E.PERIODO                    AS CHAR(2)    )  AS periodo         ,CAST(E.ANIOMES                    AS INT        )  AS aniomes       --,CAST(E.FECMVTO_FH                 AS TIMESTAMP  )  AS fch_movimiento       --,CAST(E.FECAMBIO_FH                AS TIMESTAMP  )  AS fch_cambio--ADD       --,CAST(E.FECTRAB_FH                 AS TIMESTAMP  )  AS fch_trabajo--ADD       --,CAST(E.FEPROMEC_FH                AS TIMESTAMP  )  AS fch_proceso_mec--ADD         ,CAST(E.IND_TIPO_PRIMA             AS CHAR(1)    )  AS ind_tipo_prima         ,CAST(E.IMPRNTEC_MOR               AS FLOAT      )  AS mto_prima_tecnica_ori         ,CAST(E.IMPRNTEC_PTC               AS FLOAT      )  AS mto_prima_tecnica_int         ,CAST(E.IMREPAFR_MOR               AS FLOAT      )  AS mto_prima_rpf_ori         ,CAST(E.IMREPAFR_PTC               AS FLOAT      )  AS mto_prima_rpf_int         ,CAST(E.IMDERECH_MOR               AS FLOAT      )  AS mto_gasto_der_pol_ori         ,CAST(E.IMDERECH_PTC               AS FLOAT      )  AS mto_gasto_der_pol_int         ,CAST(E.IMPRNETA_MOR               AS FLOAT      )  AS mto_prima_neta_ori         ,CAST(E.IMPRNETA_PTC               AS FLOAT      )  AS mto_prima_neta_int         ,CAST(E.IMIVAPRN_MOR               AS FLOAT      )  AS mto_iva_prima_neta_ori         ,CAST(E.IMIVADER_MOR               AS FLOAT      )  AS mto_iva_gasto_ori         ,CAST(E.IMIVAPRN_PTC               AS FLOAT      )  AS mto_iva_prima_neta_int         ,CAST(E.IMIVADER_PTC               AS FLOAT      )  AS mto_iva_gasto_int         ,CAST(E.IMGGINEX_MOR               AS FLOAT      )  AS mto_gasto_gestion_ori         ,CAST(E.IMGGINEX_PTC               AS FLOAT      )  AS mto_gasto_gestion_int         ,CAST(E.IMCESCOM_MOR               AS FLOAT      )  AS mto_cesion_comision_ori         ,CAST(E.IMCESCOM_PTC               AS FLOAT      )  AS mto_cesion_comision_int       --,CAST(E.IMPCOBRC_MOR               AS FLOAT      )  AS mto_comision_bruta_ori       --,CAST(E.IMPCOBRC_PCT               AS FLOAT      )  AS mto_comision_bruta_int         ,CAST(E.IMPRITOT_MOR               AS FLOAT      )  AS mto_prima_total_ori         ,CAST(E.IMPRITOT_PTC               AS FLOAT      )  AS mto_prima_total_int         ,CAST(E.ID_AJUSTE                  AS SMALLINT   )  AS id_ajuste         ,CAST(E.TSULTMOD                   AS TIMESTAMP  )  as ts_ultima_modificacion         ,CAST(E.TABORI                     AS CHAR(7)    )  AS tab_origen_prima     FROM (         SELECT             C.CDNUMPOL,             C.CTVRSPOL,             C.CDOBJTP,             C.CTSECOBJ,             C.CDNUMREC,--ADD             CONCAT(C.CDPRODTE,C.CDPRODCO) AS PRODUCTO, /* PRODUCTO  (CALCULADO PARA DLK_RES)*/             C.CDPRODTE,             C.CDPRODCO,             C.CDRAMDGS,        --   C.NUAPUNTE,--ADD             C.TCTINEGO,             C.CDMEDPAG,        --   C.INFISMOR,--ADD             C.CLFILTOM,             C.CDFILPAG,             C.TCTITXCT,             C.TCCOPERA,             C.CDMCT,             C.TCCDMONE,             C.CABECERA,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000             C.CDREFCAB,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000             C.TIPCAVT,             C.FECONTAB,             C.FECONTAB_FH,             C.EJERCICIO,             C.PERIODO,             C.DIA,             C.ANIOMES,             C.IND_TIPO_PRIMA,             C.CDOPERA,        --   C.INRECIFR,--ADD        --   C.CLPROTI,--ADD        --   C.CLPROUN,--ADD        --   C.CDESTRUG,--ADD        --   C.CLGESTI,--ADD        --   C.CLGESUN,--ADD        --   C.FECMVTO_FH,--ADD        --   C.FECAMBIO_FH,--ADD        --   C.FECTRAB_FH,--ADD        --   C.FEPROMEC_FH,--ADD        --   C.TCDOMORI,--ADD        --   C.NUSECMVO,--ADD--ADD        --   C.INDEMIAN,--ADD--ADD        --   C.NUTRAB,--ADD--ADD        --   C.CDINTERC,--ADD--ADD        --   C.CDESTRUP,--ADD             SUM(C.IMPRNTEC) AS IMPRNTEC_MOR,             SUM(C.DESCCOME) AS DESCCOME_MOR,             SUM(C.IMREPAFR) AS IMREPAFR_MOR,             SUM(C.IMDERECH) AS IMDERECH_MOR,             SUM(C.IMIVAPRN) AS IMIVAPRN_MOR,             SUM(C.IMIVADER) AS IMIVADER_MOR,             SUM(C.IMGGINEX) AS IMGGINEX_MOR,             SUM(C.IMCESCOM) AS IMCESCOM_MOR,             SUM(C.IMPRNETA) AS IMPRNETA_MOR,             SUM(C.IMPRITOT) AS IMPRITOT_MOR,             SUM(C.IMPCOBRC) AS IMPCOBRC_MOR,             SUM(C.IMPRNTEC * C.TIPCAVT) AS IMPRNTEC_PTC,             SUM(C.DESCCOME * C.TIPCAVT) AS DESCCOME_PTC,             SUM(C.IMREPAFR * C.TIPCAVT) AS IMREPAFR_PTC,             SUM(C.IMDERECH * C.TIPCAVT) AS IMDERECH_PTC,             SUM(C.IMIVAPRN * C.TIPCAVT) AS IMIVAPRN_PTC,             SUM(C.IMIVADER * C.TIPCAVT) AS IMIVADER_PTC,             SUM(C.IMGGINEX * C.TIPCAVT) AS IMGGINEX_PTC,             SUM(C.IMCESCOM * C.TIPCAVT) AS IMCESCOM_PTC,             SUM(C.IMPRNETA * C.TIPCAVT) AS IMPRNETA_PTC,             SUM(C.IMPRITOT * C.TIPCAVT) AS IMPRITOT_PTC,             SUM(C.IMPCOBRC * C.TIPCAVT) AS IMPCOBRC_PTC,             MAX(C.ID_AJUSTE) AS ID_AJUSTE,             MAX(C.tsultmod)  AS TSULTMOD,--ADD             C.TABORI,             C.SISTORIG         FROM (             SELECT                 B.CDNUMPOL,                 B.CTVRSPOL,                 B.CDOBJTP,                 B.CTSECOBJ,                 B.CDNUMREC,                 B.CDPRODTE,                 B.CDPRODCO,                 B.CDRAMDGS,             --  B.NUAPUNTE,                 B.TCTINEGO,                 B.CDMEDPAG,             --  B.INFISMOR,                 B.CLFILTOM,                 B.CDFILPAG,                 B.TCTITXCT,                 B.TCCOPERA,                 B.CDMCT,                 B.TCCDMONE,                 CASE B.TCCDMONE                     WHEN 'MXP'                     THEN 1                     ELSE                         CASE                             WHEN TC.VATIPCAV IS NOT NULL                             THEN TC.VATIPCAV                             ELSE                                  CASE                                      WHEN TC2.VATIPCAV IS NOT NULL                                      THEN TC2.VATIPCAV                                      ELSE                                         CASE                                             WHEN TC3.VATIPCAV IS NOT NULL                                             THEN TC3.VATIPCAV                                             ELSE                                                 CASE                                                     WHEN TC4.VATIPCAV IS NOT NULL                                                     THEN TC4.VATIPCAV                                                     ELSE                                                         CASE                                                             WHEN TC5.VATIPCAV IS NOT NULL                                                             THEN TC5.VATIPCAV                                                             ELSE NULL                                                         END                                                 END                                         END                                 END                         END                 END AS TIPCAVT,                 CASE B.TCCDMONE                     WHEN 'MXP'                     THEN 1                     ELSE                         CASE                             WHEN TC.VATIPCAV IS NOT NULL                             THEN 2                             ELSE                                  CASE                                      WHEN TC2.VATIPCAV IS NOT NULL                                      THEN 3                                      ELSE                                         CASE                                             WHEN TC3.VATIPCAV IS NOT NULL                                             THEN 4                                             ELSE                                                 CASE                                                     WHEN TC4.VATIPCAV IS NOT NULL                                                     THEN 5                                                     ELSE                                                         CASE                                                             WHEN TC5.VATIPCAV IS NOT NULL                                                             THEN 6                                                             ELSE 0                                                         END                                                 END                                         END                                  END                         END                 END AS ID_AJUSTE,                 B.FECONTAB,                 B.FECONTAB_FH,                 CAST(SUBSTR(CAST (FECONTAB AS STRING),1,4) AS INTEGER) AS EJERCICIO,                 SUBSTR(CAST (FECONTAB AS STRING),5,2) AS PERIODO,                 CAST(SUBSTR(CAST (FECONTAB AS STRING),7,2) AS INT) AS DIA,                 CAST(SUBSTR(CAST (FECONTAB AS STRING),1,6) AS INT) AS ANIOMES,                 B.IND_TIPO_PRIMA,                 B.CABECERA,   ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000                 B.CDREFCAB,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000                 B.CDOPERA,             --  B.INRECIFR,             --  B.CLPROTI,             --  B.CLPROUN,             --  B.CDESTRUG,             --  B.CLGESTI,             --  B.CLGESUN,             --  B.FECMVTO_FH,             --  B.FECAMBIO_FH,             --  B.FECTRAB_FH,             --  B.FEPROMEC_FH,             --  B.TCDOMORI,             --  B.NUSECMVO,             --  B.INDEMIAN,             --  B.NUTRAB,             --  B.CDINTERC,             --  B.CDESTRUP,                 B.IMPRNTEC,                 B.DESCCOME,                 B.IMREPAFR,                 B.IMDERECH,                 B.IMIVAPRN,                 B.IMIVADER,                 B.IMGGINEX,                 B.IMCESCOM,                 B.IMPRNETA,                 B.IMPCOBRC,                 B.IMPRITOT,                 B.TABORI,                 B.tsultmod,--ADD                 B.SISTORIG             FROM (---inicio B                 SELECT                     A.CDNUMPOL,                     A.CTVRSPOL,                     A.CDOBJTP,                     A.CTSECOBJ,                     A.CDNUMREC,                     A.CDPRODTE,                     A.CDPRODCO,                     A.CDRAMDGS,                  -- A.NUAPUNTE,                     A.TCTINEGO,                     A.CDMEDPAG,                  -- A.INFISMOR,                     A.CLFILTOM,                     A.CDFILPAG,                     A.TCTITXCT,                     A.TCCOPERA,                     'C' AS IND_TIPO_PRIMA,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMPRNTEC                         WHEN '001005' THEN  IMPRNTEC  * -1                         WHEN '003004' THEN  IMPRNTEC  * -1                         WHEN '003005' THEN  IMPRNTEC                         ELSE 0                      END AS  IMPRNTEC,                     CASE A.CDOPERA                         WHEN '001004' THEN  DESCCOME                         WHEN '001005' THEN  DESCCOME  * -1                         WHEN '003004' THEN  DESCCOME  * -1                         WHEN '003005' THEN  DESCCOME                         ELSE 0                      END AS  DESCCOME,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMREPAFR                         WHEN '001005' THEN  IMREPAFR  * -1                         WHEN '003004' THEN  IMREPAFR  * -1                         WHEN '003005' THEN  IMREPAFR                            ELSE 0                      END AS  IMREPAFR,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMDERECH                         WHEN '001005' THEN  IMDERECH  * -1                         WHEN '003004' THEN  IMDERECH  * -1                         WHEN '003005' THEN  IMDERECH                            ELSE 0                      END AS  IMDERECH,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMIVAPRN                         WHEN '001005' THEN  IMIVAPRN  * -1                         WHEN '003004' THEN  IMIVAPRN  * -1                         WHEN '003005' THEN  IMIVAPRN                            ELSE 0                      END AS  IMIVAPRN,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMIVADER                         WHEN '001005' THEN  IMIVADER  * -1                         WHEN '003004' THEN  IMIVADER  * -1                         WHEN '003005' THEN  IMIVADER                            ELSE 0                      END AS  IMIVADER,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMGGINEX                         WHEN '001005' THEN  IMGGINEX  * -1                         WHEN '003004' THEN  IMGGINEX  * -1                         WHEN '003005' THEN  IMGGINEX                            ELSE 0                      END AS  IMGGINEX,                      CASE A.CDOPERA                         WHEN '001004' THEN  IMCESCOM                         WHEN '001005' THEN  IMCESCOM  * -1                         WHEN '003004' THEN  IMCESCOM  * -1                         WHEN '003005' THEN  IMCESCOM                            ELSE 0                      END AS  IMCESCOM,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMPRNETA                         WHEN '001005' THEN  IMPRNETA  * -1                         WHEN '003004' THEN  IMPRNETA  * -1                         WHEN '003005' THEN  IMPRNETA                            ELSE 0                      END AS  IMPRNETA,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMPCOBRC                         WHEN '001005' THEN  IMPCOBRC  * -1                         WHEN '003004' THEN  IMPCOBRC  * -1                         WHEN '003005' THEN  IMPCOBRC                            ELSE 0                      END AS  IMPCOBRC,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMPRITOT                         WHEN '001005' THEN  IMPRITOT  * -1                         WHEN '003004' THEN  IMPRITOT  * -1                         WHEN '003005' THEN  IMPRITOT                            ELSE 0                      END AS  IMPRITOT,                     A.TCCDMONE,                     A.FECONTAB,                     A.FECONTAB_FH,                     A2.CABECERA,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000                     A2.CDREFCAB,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000                     A.CDMCT,                     A.CDOPERA,                  -- A.INRECIFR,                  -- A.CLPROTI,                  -- A.CLPROUN,                  -- A.CDESTRUG,                  -- A.CLGESTI,                  -- A.CLGESUN,                  -- A.TCDOMORI,                  -- CAST(CONCAT(SUBSTR(CAST (A.FECMVTO AS STRING),1,4),'-',SUBSTR(CAST (A.FECMVTO AS STRING),5,2),'-',SUBSTR(CAST (A.FECMVTO AS STRING),7,2)) AS TIMESTAMP) as FECMVTO_FH,                  -- CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP) as FECAMBIO_FH,                  -- CAST(CONCAT(SUBSTR(CAST (A.FECTRAB AS STRING),1,4),'-',SUBSTR(CAST (A.FECTRAB AS STRING),5,2),'-',SUBSTR(CAST (A.FECTRAB AS STRING),7,2)) AS TIMESTAMP) as FECTRAB_FH,                  -- CAST(CONCAT(SUBSTR(CAST (A.FEPROMEC AS STRING),1,4),'-',SUBSTR(CAST (A.FEPROMEC AS STRING),5,2),'-',SUBSTR(CAST (A.FEPROMEC AS STRING),7,2)) AS TIMESTAMP) as FEPROMEC_FH,                  -- A.NUSECMVO,                  -- A.INDEMIAN,                  -- A.NUTRAB,                  -- A.CDINTERC,                  -- A.CDESTRUP,                     'KTOM41' AS TABORI,                     A.tsultmod,                     A.SISTORIG                     FROM (                             SELECT                                 CDNUMPOL, CTVRSPOL, CDOBJTP, CTSECOBJ, FECONTAB,FECAMBIO,CDCIAGRU, CDNUMREC, INRECIFR, INDEMIAN,NUAPUNTE,FEPROMEC, CDINTERC, TCCDMONE, FECMVTO, TCDOMORI, NUSECMVO, NUTRAB,FECTRAB,                                 CAST(CONCAT(SUBSTR(CAST (FECONTAB AS STRING),1,4),'-',SUBSTR(CAST (FECONTAB AS STRING),5,2),'-',SUBSTR(CAST (FECONTAB AS STRING),7,2)) AS TIMESTAMP) AS FECONTAB_FH,                                 CDPRODTE, CDPRODCO, CDESTRUP, CDRAMDGS, TCTINEGO, CDMEDPAG, INFISMOR, CLPROTI, CLPROUN, CDESTRUG, CLGESTI, CLGESUN,                                 CLFILTOM, CDFILPAG,TCTITXCT,CDOPERA, CDMCT,TCCOPERA,                                 sum(IMPRNTEC) as IMPRNTEC,                      /* PRIMA TECNICA */                                 sum(DESCCOME) as DESCCOME,                      /* DESC. COMERCIAL */                                 sum(IMREPAFR) as IMREPAFR,                      /* RECARGO PAGO FRACCIONADO (Y DESC POR DOMICILIACION) */                                 sum(IMDERECH) as IMDERECH,                      /* DERECHOS */                                 sum(IMIVAPRN) as IMIVAPRN,                      /* IVA SOBRE PRIMA NETA */                                 sum(IMIVADER) as IMIVADER,                      /* IVA SOBRE DERECHOS */                                 sum(IMGGINEX) as IMGGINEX,                      /* GASTOS DE GESTION INTERNA Y EXTERNA */                                 sum(IMCESCOM) as IMCESCOM,                      /* CESION DE COMISION */                                 sum(IMPRNETA) as IMPRNETA,                      /* PRIMA NETA */                                 sum(IMPRITOT) as IMPRITOT,                      /* PRIMA TOTAL */                                 sum(IMPCOBRC) as IMPCOBRC,                      /* IMPORTE COMISION BRUTA C*/                                 MAX(tsultmod) as tsultmod,                                 SISTORIG                             FROM (                                     SELECT                                          CDNUMPOL, CTVRSPOL, CDOBJTP, CTSECOBJ,FECONTAB,FECAMBIO,CDCIAGRU,CDNUMREC, INRECIFR, INDEMIAN,NUAPUNTE,FEPROMEC,CDINTERC,TCCDMONE,FECMVTO,TCDOMORI,NUSECMVO,NUTRAB,FECTRAB,                                          CDPRODTE, CDPRODCO, CDESTRUP, CDRAMDGS, TCTINEGO, CDMEDPAG, INFISMOR, CLPROTI, CLPROUN, CDESTRUG, CLGESTI,CLGESUN,                                          CLFILTOM, CDFILPAG,TCTITXCT,CONCAT(TCTITXCT,TCCOPERA) AS CDOPERA, CDMCT, TCCOPERA,                                          IMPCEC01 AS IMPRNTEC,                                  /* PRIMA TECNICA */                                          IMPCEC18 AS IMPCOBRC,                                  /* IMPORTE COMISION BRUTA C*/                                          IMPCEC09 AS DESCCOME,                                  /* DESC. COMERCIAL */                                          IMPCEC03 + IMPCEC07 AS IMREPAFR,                       /* IMP. RECARGOS (PAGO FRACCIONADO Y DESC POR DOMICILIACION) */                                          IMPCEC04 AS IMDERECH,                                  /* DERECHOS */                                          IMPCEC05 AS IMIVAPRN,                                  /* IVA SOBRE PRIMA NETA */                                          IMPCEC06 AS IMIVADER,                                  /* IVA SOBRE DERECHOS */                                          IMPCEC10 AS IMGGINEX,                                  /* GASTOS DE GESTION INTERNA Y EXTERNA */                                          IMPCEC02 AS IMCESCOM,                                  /* CESION DE COMISION */                                          IMPCEC19 AS IMPRNETA,                                  /* PRIMA NETA */                                          IMPCEC20 AS IMPRITOT,                                  /* PRIMA TOTAL */                                          tsultmod,                                          'INFO' AS SISTORIG                                     FROM  bddltrn.ktom41  T                              --- MEC SEGURO DIRECTO                                     WHERE  CDCIAGRU = 'AU'                      /* CODIGO COMPANIA GRUPO */                                           AND TCTITXCT IN ('001','003')              /* TC TIPO TRANSACCION CONTABLE */                                           AND TCCOPERA IN ('004','005')    /* TC CODIGO OPERACION CONTABLE (SEGUN IBM AUNQUE EN REALIDAD NO SE APRECIA QUE OCURRAN EN AUTOS LOS TCCOPERA '002' Y '006') */                                     ----- Muesta de ejemplo ---------------------------------------------------------------------------------                                           and CDNUMPOL in (                                                                  '00000206050452', '00000197538226', '00000188949903', '00000228274726', '00000161422936',                                                                '00000152877981','00000220400931','00000220999841'                                            )                                     --------------------------------------------------------------------------------------------------------                                 ) PRP                             GROUP BY                                 CDNUMPOL, CTVRSPOL, CDOBJTP, CTSECOBJ, FECONTAB,FECAMBIO, CDCIAGRU, CDNUMREC, INRECIFR, INDEMIAN,NUAPUNTE,FEPROMEC, CDINTERC, TCCDMONE, FECMVTO, TCDOMORI, NUSECMVO, NUTRAB, FECTRAB,                                 CDPRODTE, CDPRODCO, CDESTRUP, CDRAMDGS, TCTINEGO, CDMEDPAG, INFISMOR, CLPROTI, CLPROUN, CDESTRUG, CLGESTI, CLGESUN,                                 CLFILTOM, CDFILPAG,TCTITXCT,CDOPERA, CDMCT, TCCOPERA,SISTORIG                     ) A                     LEFT OUTER JOIN (                             SELECT                                 CDNUMPOL, CTVRSPOL, CDCIAGRU,  FECONTAB, NUSECMVO, NUTRAB, CDNUMREC, INRECIFR, INDEMIAN, FEPRECON,                                 TCCDMONE, FEPROMEC, CDINTERC, FECMVTO, FECTRAB, CDREFCAB, SUBSTR(TRIM(CDREFCAB),1,2) AS CABECERA    ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000                             FROM (--Se adiciono el query para quitar duplicados en CDREFCAB                                     select                                          PARC.CDNUMPOL,PARC.CTVRSPOL,PARC.CDCIAGRU,PARC.FECONTAB,PARC.NUSECMVO,PARC.NUTRAB,PARC.CDNUMREC,PARC.INRECIFR,PARC.FEPRECON,PARC.INDEMIAN,                                         PARC.TCCDMONE,PARC.FEPROMEC,PARC.CDINTERC,PARC.FECMVTO,PARC.FECTRAB,PARC.CDREFCAB, SUBSTR(TRIM(PARC.CDREFCAB),1,2) AS CABECERA,                                         PARC.fechaaud                                     from                                           (                                             SELECT                                                 CDNUMPOL, CTVRSPOL, CDCIAGRU,  FECONTAB, NUSECMVO, NUTRAB, CDNUMREC, INRECIFR, FEPRECON,                                                 TCCDMONE, FEPROMEC, CDINTERC, FECMVTO, FECTRAB, CDREFCAB, SUBSTR(TRIM(CDREFCAB),1,2) AS CABECERA                                                 ,fechaaud,INDEMIAN                                             FROM bddldes.ktoa41t_union A --- MEC SEGURO DIRECTO                                             WHERE  CDCIAGRU = 'AU'                                          )PARC                                         LEFT OUTER JOIN                                         (                                              SELECT                                                  CDNUMREC,CDNUMPOL,CTVRSPOL,FECONTAB,FECMVTO,NUSECMVO,CDINTERC,TCCDMONE,NUTRAB,FECTRAB,INRECIFR,                                                  INDEMIAN, MAX(fechaaud) AS fechaaud                                              FROM bddldes.ktoa41t_union A                                              GROUP BY                                                     CDNUMREC,CDNUMPOL,CTVRSPOL,FECONTAB,FECMVTO,NUSECMVO,CDINTERC,TCCDMONE,NUTRAB,                                                   FECTRAB,INRECIFR,INDEMIAN                                         )PARC2                                         ON(PARC.CDNUMREC = PARC2.CDNUMREC  AND                                             PARC.CDNUMPOL = PARC2.CDNUMPOL  AND                                              PARC.CTVRSPOL = PARC2.CTVRSPOL AND                                            PARC.FECONTAB = PARC2.FECONTAB  AND                                            PARC.FECMVTO  = PARC2.FECMVTO   AND                                                PARC.NUSECMVO = PARC2.NUSECMVO  AND                                             PARC.CDINTERC = PARC2.CDINTERC  AND                                               PARC.TCCDMONE = PARC2.TCCDMONE  AND                                             PARC.NUTRAB   = PARC2.NUTRAB    AND                                                PARC.FECTRAB  = PARC2.FECTRAB   AND                                               PARC.INRECIFR = PARC2.INRECIFR  AND                                             PARC.INDEMIAN = PARC2.INDEMIAN  AND                                            PARC.fechaaud = PARC2.fechaaud                                         )                                     WHERE PARC2.fechaaud IS NOT NULL                      /* CODIGO COMPANIA GRUPO */                                 ) CABPRP                             GROUP BY                                 CDNUMPOL, CTVRSPOL, CDCIAGRU,  FECONTAB, NUSECMVO, NUTRAB, CDNUMREC, INRECIFR, INDEMIAN, FEPRECON,                                 TCCDMONE, FEPROMEC, CDINTERC, FECMVTO, FECTRAB, CDREFCAB,  SUBSTR(TRIM(CDREFCAB),7,2)                     ) A2                     ON ( TRIM(A.CDCIAGRU)  = TRIM(A2.CDCIAGRU) AND                         A.CDNUMREC  = A2.CDNUMREC AND                         A.CDNUMPOL  = A2.CDNUMPOL AND                         A.CTVRSPOL  = A2.CTVRSPOL AND                         A.FECONTAB  = A2.FECONTAB AND                         A.FECMVTO   = A2.FECMVTO  AND                         A.NUSECMVO  = A2.NUSECMVO AND                         A.CDINTERC  = A2.CDINTERC AND                         A.TCCDMONE  = A2.TCCDMONE AND                         A.NUTRAB    = A2.NUTRAB   AND                         A.FECTRAB   = A2.FECTRAB  AND                         A.INRECIFR  = A2.INRECIFR AND                         A.INDEMIAN  = A2.INDEMIAN                         )             ) B              -- TIPO DE CAMBIO             LEFT OUTER JOIN (                             SELECT DISTINCT A.CDDIVDES, A.CDDIVORI, A.FECAMBIO, A.VATIPCAV,                                      CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP ) AS FECAMBIO_FCH                                      FROM BDDLCRU.KTOTCAT A                                      INNER JOIN                                      (                                      SELECT CDDIVDES, CDDIVORI, MAX(CTVRSCAM) AS MAX_CTVRSCAM, FECAMBIO                                      FROM BDDLCRU.KTOTCAT GROUP BY CDDIVDES, CDDIVORI, FECAMBIO                                      ) B                                      ON (A.CDDIVDES = B.CDDIVDES AND A.CTVRSCAM = B.MAX_CTVRSCAM                                         AND  A.CDDIVORI = B.CDDIVORI AND A.FECAMBIO = B.FECAMBIO)                                      WHERE A.FECAMBIO > 0             ) TC             ON (TC.CDDIVORI = B.TCCDMONE AND TC.FECAMBIO_FCH = B.FECONTAB_FH)             LEFT OUTER JOIN (                              SELECT DISTINCT A.CDDIVDES, A.CDDIVORI, A.FECAMBIO, A.VATIPCAV,                                      CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP ) AS FECAMBIO_FCH                                      FROM BDDLCRU.KTOTCAT A                                      INNER JOIN                                      (                                      SELECT CDDIVDES, CDDIVORI, MAX(CTVRSCAM) AS MAX_CTVRSCAM, FECAMBIO                                      FROM BDDLCRU.KTOTCAT GROUP BY CDDIVDES, CDDIVORI, FECAMBIO                                      ) B                                      ON (A.CDDIVDES = B.CDDIVDES AND A.CTVRSCAM = B.MAX_CTVRSCAM                                         AND  A.CDDIVORI = B.CDDIVORI AND A.FECAMBIO = B.FECAMBIO)                                      WHERE A.FECAMBIO > 0             ) TC2             ON (TC2.CDDIVORI = B.TCCDMONE AND TC2.FECAMBIO_FCH = DAYS_SUB(B.FECONTAB_FH,1))             --ON (TC2.CDDIVORI = B.TCCDMONE AND TC2.FECAMBIO_FCH =  (FECONTAB_FH-1 DAY))             LEFT OUTER JOIN (                              SELECT DISTINCT A.CDDIVDES, A.CDDIVORI, A.FECAMBIO, A.VATIPCAV,                                      CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP ) AS FECAMBIO_FCH                                      FROM BDDLCRU.KTOTCAT A                                      INNER JOIN                                      (                                      SELECT CDDIVDES, CDDIVORI, MAX(CTVRSCAM) AS MAX_CTVRSCAM, FECAMBIO                                      FROM BDDLCRU.KTOTCAT GROUP BY CDDIVDES, CDDIVORI, FECAMBIO                                      ) B                                  ",,,,,,,,,
   ON (A.CDDIVDES = B.CDDIVDES AND A.CTVRSCAM = B.MAX_CTVRSCAM,,,,,,,,,,,,,,,,,,,,,,,,
                                         AND  A.CDDIVORI = B.CDDIVORI AND A.FECAMBIO = B.FECAMBIO),,,,,,,,,,,,,,,,,,,,,,,,
                                      WHERE A.FECAMBIO > 0,,,,,,,,,,,,,,,,,,,,,,,,
             ) TC3,,,,,,,,,,,,,,,,,,,,,,,,
             ON (TC3.CDDIVORI = B.TCCDMONE AND TC3.FECAMBIO_FCH = DAYS_SUB(B.FECONTAB_FH,2)),,,,,,,,,,,,,,,,,,,,,,,
           --  ON (TC3.CDDIVORI = B.TCCDMONE AND TC3.FECAMBIO_FCH = (FECONTAB_FH-2 DAY)),,,,,,,,,,,,,,,,,,,,,,,,
             LEFT OUTER JOIN (,,,,,,,,,,,,,,,,,,,,,,,,
                              SELECT DISTINCT A.CDDIVDES, A.CDDIVORI, A.FECAMBIO, A.VATIPCAV,,,,,,,,,,,,,,,,,,,,,
                                      CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP ) AS FECAMBIO_FCH,,,,,,,,,,,,,,
                                      FROM BDDLCRU.KTOTCAT A,,,,,,,,,,,,,,,,,,,,,,,,
                                      INNER JOIN,,,,,,,,,,,,,,,,,,,,,,,,
                                      (,,,,,,,,,,,,,,,,,,,,,,,,
                                      SELECT CDDIVDES, CDDIVORI, MAX(CTVRSCAM) AS MAX_CTVRSCAM, FECAMBIO,,,,,,,,,,,,,,,,,,,,,
                                      FROM BDDLCRU.KTOTCAT GROUP BY CDDIVDES, CDDIVORI, FECAMBIO,,,,,,,,,,,,,,,,,,,,,,
                                      ) B,,,,,,,,,,,,,,,,,,,,,,,,
                                      ON (A.CDDIVDES = B.CDDIVDES AND A.CTVRSCAM = B.MAX_CTVRSCAM,,,,,,,,,,,,,,,,,,,,,,,,
                                         AND  A.CDDIVORI = B.CDDIVORI AND A.FECAMBIO = B.FECAMBIO),,,,,,,,,,,,,,,,,,,,,,,,
                                      WHERE A.FECAMBIO > 0,,,,,,,,,,,,,,,,,,,,,,,,
             ) TC4,,,,,,,,,,,,,,,,,,,,,,,,
             ON (TC4.CDDIVORI = B.TCCDMONE AND TC4.FECAMBIO_FCH = DAYS_SUB(B.FECONTAB_FH,3)),,,,,,,,,,,,,,,,,,,,,,,
           --  ON (TC4.CDDIVORI = B.TCCDMONE AND TC4.FECAMBIO_FCH = (FECONTAB_FH-3 DAY)),,,,,,,,,,,,,,,,,,,,,,,,
             LEFT OUTER JOIN (,,,,,,,,,,,,,,,,,,,,,,,,
                              SELECT DISTINCT A.CDDIVDES, A.CDDIVORI, A.FECAMBIO, A.VATIPCAV,,,,,,,,,,,,,,,,,,,,,
                                      CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP ) AS FECAMBIO_FCH,,,,,,,,,,,,,,
                                      FROM BDDLCRU.KTOTCAT A,,,,,,,,,,,,,,,,,,,,,,,,
                                      INNER JOIN,,,,,,,,,,,,,,,,,,,,,,,,
                                      (,,,,,,,,,,,,,,,,,,,,,,,,
                                      SELECT CDDIVDES, CDDIVORI, MAX(CTVRSCAM) AS MAX_CTVRSCAM, FECAMBIO,,,,,,,,,,,,,,,,,,,,,
                                      FROM BDDLCRU.KTOTCAT GROUP BY CDDIVDES, CDDIVORI, FECAMBIO,,,,,,,,,,,,,,,,,,,,,,
                                      ) B,,,,,,,,,,,,,,,,,,,,,,,,
                                      ON (A.CDDIVDES = B.CDDIVDES AND A.CTVRSCAM = B.MAX_CTVRSCAM,,,,,,,,,,,,,,,,,,,,,,,,
                                         AND  A.CDDIVORI = B.CDDIVORI AND A.FECAMBIO = B.FECAMBIO),,,,,,,,,,,,,,,,,,,,,,,,
                                      WHERE A.FECAMBIO > 0,,,,,,,,,,,,,,,,,,,,,,,,
             ) TC5,,,,,,,,,,,,,,,,,,,,,,,,
             ON (TC5.CDDIVORI = B.TCCDMONE AND TC5.FECAMBIO_FCH = DAYS_SUB(B.FECONTAB_FH,4)),,,,,,,,,,,,,,,,,,,,,,,
           --  ON (TC5.CDDIVORI = B.TCCDMONE AND TC5.FECAMBIO_FCH = (FECONTAB_FH-4 DAY)),,,,,,,,,,,,,,,,,,,,,,,,
             LEFT OUTER JOIN (,,,,,,,,,,,,,,,,,,,,,,,,
                              SELECT DISTINCT A.CDDIVDES, A.CDDIVORI, A.FECAMBIO, A.VATIPCAV,,,,,,,,,,,,,,,,,,,,,
                                      CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP ) AS FECAMBIO_FCH,,,,,,,,,,,,,,
                                      FROM BDDLCRU.KTOTCAT A,,,,,,,,,,,,,,,,,,,,,,,,
                                      INNER JOIN,,,,,,,,,,,,,,,,,,,,,,,,
                                      (,,,,,,,,,,,,,,,,,,,,,,,,
                                      SELECT CDDIVDES, CDDIVORI, MAX(CTVRSCAM) AS MAX_CTVRSCAM, FECAMBIO,,,,,,,,,,,,,,,,,,,,,
                                      FROM BDDLCRU.KTOTCAT GROUP BY CDDIVDES, CDDIVORI, FECAMBIO,,,,,,,,,,,,,,,,,,,,,,
                                      ) B,,,,,,,,,,,,,,,,,,,,,,,,
                                      ON (A.CDDIVDES = B.CDDIVDES AND A.CTVRSCAM = B.MAX_CTVRSCAM,,,,,,,,,,,,,,,,,,,,,,,,
                                         AND  A.CDDIVORI = B.CDDIVORI AND A.FECAMBIO = B.FECAMBIO),,,,,,,,,,,,,,,,,,,,,,,,
                                      WHERE A.FECAMBIO > 0,,,,,,,,,,,,,,,,,,,,,,,,
             ) TC6,,,,,,,,,,,,,,,,,,,,,,,,
             ON (TC6.CDDIVORI = B.TCCDMONE AND TC6.FECAMBIO_FCH = DAYS_SUB(B.FECONTAB_FH,5)),,,,,,,,,,,,,,,,,,,,,,,
         ) C,,,,,,,,,,,,,,,,,,,,,,,,
         GROUP BY,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDNUMPOL,,,,,,,,,,,,,,,,,,,,,,,,
             C.CTVRSPOL,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDOBJTP,,,,,,,,,,,,,,,,,,,,,,,,
             C.CTSECOBJ,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDNUMREC,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
             C.CDPRODTE,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDPRODCO,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDRAMDGS,,,,,,,,,,,,,,,,,,,,,,,,
          -- C.NUAPUNTE,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
             C.TCTINEGO,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDMEDPAG,,,,,,,,,,,,,,,,,,,,,,,,
          -- C.INFISMOR,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
             C.CLFILTOM,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDFILPAG,,,,,,,,,,,,,,,,,,,,,,,,
             C.TCTITXCT,,,,,,,,,,,,,,,,,,,,,,,,
             C.TCCOPERA,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDMCT,,,,,,,,,,,,,,,,,,,,,,,,
             C.TCCDMONE,,,,,,,,,,,,,,,,,,,,,,,,
             C.CABECERA,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000,,,,,,,,,,,,,,,,,,,,,,,
             C.CDREFCAB,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000,,,,,,,,,,,,,,,,,,,,,,,
             C.TIPCAVT,,,,,,,,,,,,,,,,,,,,,,,,
             C.FECONTAB,,,,,,,,,,,,,,,,,,,,,,,,
             C.FECONTAB_FH,,,,,,,,,,,,,,,,,,,,,,,,
             C.EJERCICIO,,,,,,,,,,,,,,,,,,,,,,,,
             C.PERIODO,,,,,,,,,,,,,,,,,,,,,,,,
             C.DIA,,,,,,,,,,,,,,,,,,,,,,,,
             C.ANIOMES,,,,,,,,,,,,,,,,,,,,,,,,
             C.IND_TIPO_PRIMA,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDOPERA,,,,,,,,,,,,,,,,,,,,,,,,
         --  C.INRECIFR,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CLPROTI,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CLPROUN,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CDESTRUG,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CLGESTI,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CLGESUN,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.FECMVTO_FH,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.FECAMBIO_FH,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.FECTRAB_FH,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.FEPROMEC_FH,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.TCDOMORI,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.NUSECMVO,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.INDEMIAN,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.NUTRAB,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CDINTERC,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CDESTRUP,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
             C.TABORI,,,,,,,,,,,,,,,,,,,,,,,,
             C.SISTORIG,,,,,,,,,,,,,,,,,,,,,,,,
"     ) E""",,SELECT,4e4fbeeea26cff39:b1017bca00000000,ea45e81a4bdab095:6e358fa57dd055b1,"Query 4e4fbeeea26cff39:b1017bca00000000 expired due to client inactivity (timeout is 10m)
",bddldes,TABLE,,ktoa41t_union,,,,,,,,,,,,,,,
2019-11-21T20:45:35.000Z,imedrano,10.67.59.12,impala,QUERY,bddlcru:ktotcat,true,,,,,,,,,"    SELECT          CAST(E.CDNUMPOL                   AS CHAR(14)   )  AS num_poliza         ,CAST(E.CTVRSPOL                   AS INT        )  AS num_version         ,CAST(E.PRODUCTO                   AS CHAR(20)   )  AS cve_producto_venta         ,CAST(E.CDOBJTP                    AS CHAR(10)   )  AS cve_tipo_objeto         ,CAST(E.CTSECOBJ                   AS INT        )  AS consecutivo_objeto         ,CAST(E.CDNUMREC                   AS CHAR(12)   )  AS cve_recibo--ADD         ,CAST(E.CDRAMDGS                   AS CHAR(4)    )  AS cve_cobertura_contable       --,CAST(E.NUAPUNTE                   AS BIGINT     )  AS num_apunte--ADD         ,CAST(E.TCTINEGO                   AS CHAR(3)    )  AS cve_negocio_contable         ,CAST(E.CDMEDPAG                   AS CHAR(2)    )  AS cve_medio_pago       --,CAST(E.INFISMOR                   AS CHAR(1)    )  AS cve_persona_fisic_moral--ADD         ,CAST(E.CLFILTOM                   AS CHAR(10)   )  AS cod_filiacion_tomador         ,CAST(E.CDFILPAG                   AS CHAR(10)   )  AS cod_filiacion_pagador         ,CAST(E.CDMCT                      AS CHAR(10)   )  AS cve_cobertura         ,CAST(E.CDOPERA                    AS CHAR(6)    )  AS cve_operacion         ,CAST(E.TCCDMONE                   AS CHAR(3)    )  AS cve_moneda         ,CAST(E.CABECERA                   AS CHAR(2)    )  AS cabecera_de_ref_contable         ,CAST(E.CDREFCAB                   AS CHAR(10)   )  AS cve_ref_contable         ,CAST(E.TIPCAVT                    AS FLOAT      )  AS tipo_cambio       --,CAST(E.INRECIFR                   AS CHAR(1)    )  AS cve_recibo_fraccion--ADD       --,CAST(E.CLPROTI                    AS CHAR(4)    )  AS cve_tipo_ofic_productora--ADD       --,CAST(E.CLPROUN                    AS CHAR(10)   )  AS cve_unidad_ofic_productora--ADD       --,CAST(E.CDESTRUG                   AS CHAR(4)    )  AS cve_estructura_gestora--ADD       --,CAST(E.CLGESTI                    AS CHAR(4)    )  AS cve_tipo_ofic_gestora--ADD       --,CAST(E.CLGESUN                    AS CHAR(10)   )  AS cve_unidad_ofic_gestora--ADD       --,CAST(E.NUSECMVO                   AS INT        )  AS num_secuencial_movimiento--ADD       --,CAST(E.INDEMIAN                   AS CHAR(1)    )  AS ban_emision_anulacion--ADD       --,CAST(E.NUTRAB                     AS CHAR(7)    )  AS cve_trabajo--ADD       --,CAST(E.CDINTERC                   AS CHAR(10)   )  AS cve_intermediario_cobrador --ADD       --,CAST(E.CDESTRUP                   AS CHAR(4)    )  AS cve_estructura_productora--ADD         ,CAST(E.FECONTAB_FH                AS TIMESTAMP  )  AS fch_contable         ,CAST(E.EJERCICIO                  AS INT        )  AS ejercicio         ,CAST(E.PERIODO                    AS CHAR(2)    )  AS periodo         ,CAST(E.ANIOMES                    AS INT        )  AS aniomes       --,CAST(E.FECMVTO_FH                 AS TIMESTAMP  )  AS fch_movimiento       --,CAST(E.FECAMBIO_FH                AS TIMESTAMP  )  AS fch_cambio--ADD       --,CAST(E.FECTRAB_FH                 AS TIMESTAMP  )  AS fch_trabajo--ADD       --,CAST(E.FEPROMEC_FH                AS TIMESTAMP  )  AS fch_proceso_mec--ADD         ,CAST(E.IND_TIPO_PRIMA             AS CHAR(1)    )  AS ind_tipo_prima         ,CAST(E.IMPRNTEC_MOR               AS FLOAT      )  AS mto_prima_tecnica_ori         ,CAST(E.IMPRNTEC_PTC               AS FLOAT      )  AS mto_prima_tecnica_int         ,CAST(E.IMREPAFR_MOR               AS FLOAT      )  AS mto_prima_rpf_ori         ,CAST(E.IMREPAFR_PTC               AS FLOAT      )  AS mto_prima_rpf_int         ,CAST(E.IMDERECH_MOR               AS FLOAT      )  AS mto_gasto_der_pol_ori         ,CAST(E.IMDERECH_PTC               AS FLOAT      )  AS mto_gasto_der_pol_int         ,CAST(E.IMPRNETA_MOR               AS FLOAT      )  AS mto_prima_neta_ori         ,CAST(E.IMPRNETA_PTC               AS FLOAT      )  AS mto_prima_neta_int         ,CAST(E.IMIVAPRN_MOR               AS FLOAT      )  AS mto_iva_prima_neta_ori         ,CAST(E.IMIVADER_MOR               AS FLOAT      )  AS mto_iva_gasto_ori         ,CAST(E.IMIVAPRN_PTC               AS FLOAT      )  AS mto_iva_prima_neta_int         ,CAST(E.IMIVADER_PTC               AS FLOAT      )  AS mto_iva_gasto_int         ,CAST(E.IMGGINEX_MOR               AS FLOAT      )  AS mto_gasto_gestion_ori         ,CAST(E.IMGGINEX_PTC               AS FLOAT      )  AS mto_gasto_gestion_int         ,CAST(E.IMCESCOM_MOR               AS FLOAT      )  AS mto_cesion_comision_ori         ,CAST(E.IMCESCOM_PTC               AS FLOAT      )  AS mto_cesion_comision_int       --,CAST(E.IMPCOBRC_MOR               AS FLOAT      )  AS mto_comision_bruta_ori       --,CAST(E.IMPCOBRC_PCT               AS FLOAT      )  AS mto_comision_bruta_int         ,CAST(E.IMPRITOT_MOR               AS FLOAT      )  AS mto_prima_total_ori         ,CAST(E.IMPRITOT_PTC               AS FLOAT      )  AS mto_prima_total_int         ,CAST(E.ID_AJUSTE                  AS SMALLINT   )  AS id_ajuste         ,CAST(E.TSULTMOD                   AS TIMESTAMP  )  as ts_ultima_modificacion         ,CAST(E.TABORI                     AS CHAR(7)    )  AS tab_origen_prima     FROM (         SELECT             C.CDNUMPOL,             C.CTVRSPOL,             C.CDOBJTP,             C.CTSECOBJ,             C.CDNUMREC,--ADD             CONCAT(C.CDPRODTE,C.CDPRODCO) AS PRODUCTO, /* PRODUCTO  (CALCULADO PARA DLK_RES)*/             C.CDPRODTE,             C.CDPRODCO,             C.CDRAMDGS,        --   C.NUAPUNTE,--ADD             C.TCTINEGO,             C.CDMEDPAG,        --   C.INFISMOR,--ADD             C.CLFILTOM,             C.CDFILPAG,             C.TCTITXCT,             C.TCCOPERA,             C.CDMCT,             C.TCCDMONE,             C.CABECERA,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000             C.CDREFCAB,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000             C.TIPCAVT,             C.FECONTAB,             C.FECONTAB_FH,             C.EJERCICIO,             C.PERIODO,             C.DIA,             C.ANIOMES,             C.IND_TIPO_PRIMA,             C.CDOPERA,        --   C.INRECIFR,--ADD        --   C.CLPROTI,--ADD        --   C.CLPROUN,--ADD        --   C.CDESTRUG,--ADD        --   C.CLGESTI,--ADD        --   C.CLGESUN,--ADD        --   C.FECMVTO_FH,--ADD        --   C.FECAMBIO_FH,--ADD        --   C.FECTRAB_FH,--ADD        --   C.FEPROMEC_FH,--ADD        --   C.TCDOMORI,--ADD        --   C.NUSECMVO,--ADD--ADD        --   C.INDEMIAN,--ADD--ADD        --   C.NUTRAB,--ADD--ADD        --   C.CDINTERC,--ADD--ADD        --   C.CDESTRUP,--ADD             SUM(C.IMPRNTEC) AS IMPRNTEC_MOR,             SUM(C.DESCCOME) AS DESCCOME_MOR,             SUM(C.IMREPAFR) AS IMREPAFR_MOR,             SUM(C.IMDERECH) AS IMDERECH_MOR,             SUM(C.IMIVAPRN) AS IMIVAPRN_MOR,             SUM(C.IMIVADER) AS IMIVADER_MOR,             SUM(C.IMGGINEX) AS IMGGINEX_MOR,             SUM(C.IMCESCOM) AS IMCESCOM_MOR,             SUM(C.IMPRNETA) AS IMPRNETA_MOR,             SUM(C.IMPRITOT) AS IMPRITOT_MOR,             SUM(C.IMPCOBRC) AS IMPCOBRC_MOR,             SUM(C.IMPRNTEC * C.TIPCAVT) AS IMPRNTEC_PTC,             SUM(C.DESCCOME * C.TIPCAVT) AS DESCCOME_PTC,             SUM(C.IMREPAFR * C.TIPCAVT) AS IMREPAFR_PTC,             SUM(C.IMDERECH * C.TIPCAVT) AS IMDERECH_PTC,             SUM(C.IMIVAPRN * C.TIPCAVT) AS IMIVAPRN_PTC,             SUM(C.IMIVADER * C.TIPCAVT) AS IMIVADER_PTC,             SUM(C.IMGGINEX * C.TIPCAVT) AS IMGGINEX_PTC,             SUM(C.IMCESCOM * C.TIPCAVT) AS IMCESCOM_PTC,             SUM(C.IMPRNETA * C.TIPCAVT) AS IMPRNETA_PTC,             SUM(C.IMPRITOT * C.TIPCAVT) AS IMPRITOT_PTC,             SUM(C.IMPCOBRC * C.TIPCAVT) AS IMPCOBRC_PTC,             MAX(C.ID_AJUSTE) AS ID_AJUSTE,             MAX(C.tsultmod)  AS TSULTMOD,--ADD             C.TABORI,             C.SISTORIG         FROM (             SELECT                 B.CDNUMPOL,                 B.CTVRSPOL,                 B.CDOBJTP,                 B.CTSECOBJ,                 B.CDNUMREC,                 B.CDPRODTE,                 B.CDPRODCO,                 B.CDRAMDGS,             --  B.NUAPUNTE,                 B.TCTINEGO,                 B.CDMEDPAG,             --  B.INFISMOR,                 B.CLFILTOM,                 B.CDFILPAG,                 B.TCTITXCT,                 B.TCCOPERA,                 B.CDMCT,                 B.TCCDMONE,                 CASE B.TCCDMONE                     WHEN 'MXP'                     THEN 1                     ELSE                         CASE                             WHEN TC.VATIPCAV IS NOT NULL                             THEN TC.VATIPCAV                             ELSE                                  CASE                                      WHEN TC2.VATIPCAV IS NOT NULL                                      THEN TC2.VATIPCAV                                      ELSE                                         CASE                                             WHEN TC3.VATIPCAV IS NOT NULL                                             THEN TC3.VATIPCAV                                             ELSE                                                 CASE                                                     WHEN TC4.VATIPCAV IS NOT NULL                                                     THEN TC4.VATIPCAV                                                     ELSE                                                         CASE                                                             WHEN TC5.VATIPCAV IS NOT NULL                                                             THEN TC5.VATIPCAV                                                             ELSE NULL                                                         END                                                 END                                         END                                 END                         END                 END AS TIPCAVT,                 CASE B.TCCDMONE                     WHEN 'MXP'                     THEN 1                     ELSE                         CASE                             WHEN TC.VATIPCAV IS NOT NULL                             THEN 2                             ELSE                                  CASE                                      WHEN TC2.VATIPCAV IS NOT NULL                                      THEN 3                                      ELSE                                         CASE                                             WHEN TC3.VATIPCAV IS NOT NULL                                             THEN 4                                             ELSE                                                 CASE                                                     WHEN TC4.VATIPCAV IS NOT NULL                                                     THEN 5                                                     ELSE                                                         CASE                                                             WHEN TC5.VATIPCAV IS NOT NULL                                                             THEN 6                                                             ELSE 0                                                         END                                                 END                                         END                                  END                         END                 END AS ID_AJUSTE,                 B.FECONTAB,                 B.FECONTAB_FH,                 CAST(SUBSTR(CAST (FECONTAB AS STRING),1,4) AS INTEGER) AS EJERCICIO,                 SUBSTR(CAST (FECONTAB AS STRING),5,2) AS PERIODO,                 CAST(SUBSTR(CAST (FECONTAB AS STRING),7,2) AS INT) AS DIA,                 CAST(SUBSTR(CAST (FECONTAB AS STRING),1,6) AS INT) AS ANIOMES,                 B.IND_TIPO_PRIMA,                 B.CABECERA,   ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000                 B.CDREFCAB,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000                 B.CDOPERA,             --  B.INRECIFR,             --  B.CLPROTI,             --  B.CLPROUN,             --  B.CDESTRUG,             --  B.CLGESTI,             --  B.CLGESUN,             --  B.FECMVTO_FH,             --  B.FECAMBIO_FH,             --  B.FECTRAB_FH,             --  B.FEPROMEC_FH,             --  B.TCDOMORI,             --  B.NUSECMVO,             --  B.INDEMIAN,             --  B.NUTRAB,             --  B.CDINTERC,             --  B.CDESTRUP,                 B.IMPRNTEC,                 B.DESCCOME,                 B.IMREPAFR,                 B.IMDERECH,                 B.IMIVAPRN,                 B.IMIVADER,                 B.IMGGINEX,                 B.IMCESCOM,                 B.IMPRNETA,                 B.IMPCOBRC,                 B.IMPRITOT,                 B.TABORI,                 B.tsultmod,--ADD                 B.SISTORIG             FROM (---inicio B                 SELECT                     A.CDNUMPOL,                     A.CTVRSPOL,                     A.CDOBJTP,                     A.CTSECOBJ,                     A.CDNUMREC,                     A.CDPRODTE,                     A.CDPRODCO,                     A.CDRAMDGS,                  -- A.NUAPUNTE,                     A.TCTINEGO,                     A.CDMEDPAG,                  -- A.INFISMOR,                     A.CLFILTOM,                     A.CDFILPAG,                     A.TCTITXCT,                     A.TCCOPERA,                     'C' AS IND_TIPO_PRIMA,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMPRNTEC                         WHEN '001005' THEN  IMPRNTEC  * -1                         WHEN '003004' THEN  IMPRNTEC  * -1                         WHEN '003005' THEN  IMPRNTEC                         ELSE 0                      END AS  IMPRNTEC,                     CASE A.CDOPERA                         WHEN '001004' THEN  DESCCOME                         WHEN '001005' THEN  DESCCOME  * -1                         WHEN '003004' THEN  DESCCOME  * -1                         WHEN '003005' THEN  DESCCOME                         ELSE 0                      END AS  DESCCOME,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMREPAFR                         WHEN '001005' THEN  IMREPAFR  * -1                         WHEN '003004' THEN  IMREPAFR  * -1                         WHEN '003005' THEN  IMREPAFR                            ELSE 0                      END AS  IMREPAFR,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMDERECH                         WHEN '001005' THEN  IMDERECH  * -1                         WHEN '003004' THEN  IMDERECH  * -1                         WHEN '003005' THEN  IMDERECH                            ELSE 0                      END AS  IMDERECH,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMIVAPRN                         WHEN '001005' THEN  IMIVAPRN  * -1                         WHEN '003004' THEN  IMIVAPRN  * -1                         WHEN '003005' THEN  IMIVAPRN                            ELSE 0                      END AS  IMIVAPRN,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMIVADER                         WHEN '001005' THEN  IMIVADER  * -1                         WHEN '003004' THEN  IMIVADER  * -1                         WHEN '003005' THEN  IMIVADER                            ELSE 0                      END AS  IMIVADER,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMGGINEX                         WHEN '001005' THEN  IMGGINEX  * -1                         WHEN '003004' THEN  IMGGINEX  * -1                         WHEN '003005' THEN  IMGGINEX                            ELSE 0                      END AS  IMGGINEX,                      CASE A.CDOPERA                         WHEN '001004' THEN  IMCESCOM                         WHEN '001005' THEN  IMCESCOM  * -1                         WHEN '003004' THEN  IMCESCOM  * -1                         WHEN '003005' THEN  IMCESCOM                            ELSE 0                      END AS  IMCESCOM,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMPRNETA                         WHEN '001005' THEN  IMPRNETA  * -1                         WHEN '003004' THEN  IMPRNETA  * -1                         WHEN '003005' THEN  IMPRNETA                            ELSE 0                      END AS  IMPRNETA,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMPCOBRC                         WHEN '001005' THEN  IMPCOBRC  * -1                         WHEN '003004' THEN  IMPCOBRC  * -1                         WHEN '003005' THEN  IMPCOBRC                            ELSE 0                      END AS  IMPCOBRC,                     CASE A.CDOPERA                         WHEN '001004' THEN  IMPRITOT                         WHEN '001005' THEN  IMPRITOT  * -1                         WHEN '003004' THEN  IMPRITOT  * -1                         WHEN '003005' THEN  IMPRITOT                            ELSE 0                      END AS  IMPRITOT,                     A.TCCDMONE,                     A.FECONTAB,                     A.FECONTAB_FH,                     A2.CABECERA,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000                     A2.CDREFCAB,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000                     A.CDMCT,                     A.CDOPERA,                  -- A.INRECIFR,                  -- A.CLPROTI,                  -- A.CLPROUN,                  -- A.CDESTRUG,                  -- A.CLGESTI,                  -- A.CLGESUN,                  -- A.TCDOMORI,                  -- CAST(CONCAT(SUBSTR(CAST (A.FECMVTO AS STRING),1,4),'-',SUBSTR(CAST (A.FECMVTO AS STRING),5,2),'-',SUBSTR(CAST (A.FECMVTO AS STRING),7,2)) AS TIMESTAMP) as FECMVTO_FH,                  -- CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP) as FECAMBIO_FH,                  -- CAST(CONCAT(SUBSTR(CAST (A.FECTRAB AS STRING),1,4),'-',SUBSTR(CAST (A.FECTRAB AS STRING),5,2),'-',SUBSTR(CAST (A.FECTRAB AS STRING),7,2)) AS TIMESTAMP) as FECTRAB_FH,                  -- CAST(CONCAT(SUBSTR(CAST (A.FEPROMEC AS STRING),1,4),'-',SUBSTR(CAST (A.FEPROMEC AS STRING),5,2),'-',SUBSTR(CAST (A.FEPROMEC AS STRING),7,2)) AS TIMESTAMP) as FEPROMEC_FH,                  -- A.NUSECMVO,                  -- A.INDEMIAN,                  -- A.NUTRAB,                  -- A.CDINTERC,                  -- A.CDESTRUP,                     'KTOM41' AS TABORI,                     A.tsultmod,                     A.SISTORIG                     FROM (                             SELECT                                 CDNUMPOL, CTVRSPOL, CDOBJTP, CTSECOBJ, FECONTAB,FECAMBIO,CDCIAGRU, CDNUMREC, INRECIFR, INDEMIAN,NUAPUNTE,FEPROMEC, CDINTERC, TCCDMONE, FECMVTO, TCDOMORI, NUSECMVO, NUTRAB,FECTRAB,                                 CAST(CONCAT(SUBSTR(CAST (FECONTAB AS STRING),1,4),'-',SUBSTR(CAST (FECONTAB AS STRING),5,2),'-',SUBSTR(CAST (FECONTAB AS STRING),7,2)) AS TIMESTAMP) AS FECONTAB_FH,                                 CDPRODTE, CDPRODCO, CDESTRUP, CDRAMDGS, TCTINEGO, CDMEDPAG, INFISMOR, CLPROTI, CLPROUN, CDESTRUG, CLGESTI, CLGESUN,                                 CLFILTOM, CDFILPAG,TCTITXCT,CDOPERA, CDMCT,TCCOPERA,                                 sum(IMPRNTEC) as IMPRNTEC,                      /* PRIMA TECNICA */                                 sum(DESCCOME) as DESCCOME,                      /* DESC. COMERCIAL */                                 sum(IMREPAFR) as IMREPAFR,                      /* RECARGO PAGO FRACCIONADO (Y DESC POR DOMICILIACION) */                                 sum(IMDERECH) as IMDERECH,                      /* DERECHOS */                                 sum(IMIVAPRN) as IMIVAPRN,                      /* IVA SOBRE PRIMA NETA */                                 sum(IMIVADER) as IMIVADER,                      /* IVA SOBRE DERECHOS */                                 sum(IMGGINEX) as IMGGINEX,                      /* GASTOS DE GESTION INTERNA Y EXTERNA */                                 sum(IMCESCOM) as IMCESCOM,                      /* CESION DE COMISION */                                 sum(IMPRNETA) as IMPRNETA,                      /* PRIMA NETA */                                 sum(IMPRITOT) as IMPRITOT,                      /* PRIMA TOTAL */                                 sum(IMPCOBRC) as IMPCOBRC,                      /* IMPORTE COMISION BRUTA C*/                                 MAX(tsultmod) as tsultmod,                                 SISTORIG                             FROM (                                     SELECT                                          CDNUMPOL, CTVRSPOL, CDOBJTP, CTSECOBJ,FECONTAB,FECAMBIO,CDCIAGRU,CDNUMREC, INRECIFR, INDEMIAN,NUAPUNTE,FEPROMEC,CDINTERC,TCCDMONE,FECMVTO,TCDOMORI,NUSECMVO,NUTRAB,FECTRAB,                                          CDPRODTE, CDPRODCO, CDESTRUP, CDRAMDGS, TCTINEGO, CDMEDPAG, INFISMOR, CLPROTI, CLPROUN, CDESTRUG, CLGESTI,CLGESUN,                                          CLFILTOM, CDFILPAG,TCTITXCT,CONCAT(TCTITXCT,TCCOPERA) AS CDOPERA, CDMCT, TCCOPERA,                                          IMPCEC01 AS IMPRNTEC,                                  /* PRIMA TECNICA */                                          IMPCEC18 AS IMPCOBRC,                                  /* IMPORTE COMISION BRUTA C*/                                          IMPCEC09 AS DESCCOME,                                  /* DESC. COMERCIAL */                                          IMPCEC03 + IMPCEC07 AS IMREPAFR,                       /* IMP. RECARGOS (PAGO FRACCIONADO Y DESC POR DOMICILIACION) */                                          IMPCEC04 AS IMDERECH,                                  /* DERECHOS */                                          IMPCEC05 AS IMIVAPRN,                                  /* IVA SOBRE PRIMA NETA */                                          IMPCEC06 AS IMIVADER,                                  /* IVA SOBRE DERECHOS */                                          IMPCEC10 AS IMGGINEX,                                  /* GASTOS DE GESTION INTERNA Y EXTERNA */                                          IMPCEC02 AS IMCESCOM,                                  /* CESION DE COMISION */                                          IMPCEC19 AS IMPRNETA,                                  /* PRIMA NETA */                                          IMPCEC20 AS IMPRITOT,                                  /* PRIMA TOTAL */                                          tsultmod,                                          'INFO' AS SISTORIG                                     FROM  bddltrn.ktom41  T                              --- MEC SEGURO DIRECTO                                     WHERE  CDCIAGRU = 'AU'                      /* CODIGO COMPANIA GRUPO */                                           AND TCTITXCT IN ('001','003')              /* TC TIPO TRANSACCION CONTABLE */                                           AND TCCOPERA IN ('004','005')    /* TC CODIGO OPERACION CONTABLE (SEGUN IBM AUNQUE EN REALIDAD NO SE APRECIA QUE OCURRAN EN AUTOS LOS TCCOPERA '002' Y '006') */                                     ----- Muesta de ejemplo ---------------------------------------------------------------------------------                                           and CDNUMPOL in (                                                                  '00000206050452', '00000197538226', '00000188949903', '00000228274726', '00000161422936',                                                                '00000152877981','00000220400931','00000220999841'                                            )                                     --------------------------------------------------------------------------------------------------------                                 ) PRP                             GROUP BY                                 CDNUMPOL, CTVRSPOL, CDOBJTP, CTSECOBJ, FECONTAB,FECAMBIO, CDCIAGRU, CDNUMREC, INRECIFR, INDEMIAN,NUAPUNTE,FEPROMEC, CDINTERC, TCCDMONE, FECMVTO, TCDOMORI, NUSECMVO, NUTRAB, FECTRAB,                                 CDPRODTE, CDPRODCO, CDESTRUP, CDRAMDGS, TCTINEGO, CDMEDPAG, INFISMOR, CLPROTI, CLPROUN, CDESTRUG, CLGESTI, CLGESUN,                                 CLFILTOM, CDFILPAG,TCTITXCT,CDOPERA, CDMCT, TCCOPERA,SISTORIG                     ) A                     LEFT OUTER JOIN (                             SELECT                                 CDNUMPOL, CTVRSPOL, CDCIAGRU,  FECONTAB, NUSECMVO, NUTRAB, CDNUMREC, INRECIFR, INDEMIAN, FEPRECON,                                 TCCDMONE, FEPROMEC, CDINTERC, FECMVTO, FECTRAB, CDREFCAB, SUBSTR(TRIM(CDREFCAB),1,2) AS CABECERA    ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000                             FROM (--Se adiciono el query para quitar duplicados en CDREFCAB                                     select                                          PARC.CDNUMPOL,PARC.CTVRSPOL,PARC.CDCIAGRU,PARC.FECONTAB,PARC.NUSECMVO,PARC.NUTRAB,PARC.CDNUMREC,PARC.INRECIFR,PARC.FEPRECON,PARC.INDEMIAN,                                         PARC.TCCDMONE,PARC.FEPROMEC,PARC.CDINTERC,PARC.FECMVTO,PARC.FECTRAB,PARC.CDREFCAB, SUBSTR(TRIM(PARC.CDREFCAB),1,2) AS CABECERA,                                         PARC.fechaaud                                     from                                           (                                             SELECT                                                 CDNUMPOL, CTVRSPOL, CDCIAGRU,  FECONTAB, NUSECMVO, NUTRAB, CDNUMREC, INRECIFR, FEPRECON,                                                 TCCDMONE, FEPROMEC, CDINTERC, FECMVTO, FECTRAB, CDREFCAB, SUBSTR(TRIM(CDREFCAB),1,2) AS CABECERA                                                 ,fechaaud,INDEMIAN                                             FROM bddldes.ktoa41t_union A --- MEC SEGURO DIRECTO                                             WHERE  CDCIAGRU = 'AU'                                          )PARC                                         LEFT OUTER JOIN                                         (                                              SELECT                                                  CDNUMREC,CDNUMPOL,CTVRSPOL,FECONTAB,FECMVTO,NUSECMVO,CDINTERC,TCCDMONE,NUTRAB,FECTRAB,INRECIFR,                                                  INDEMIAN, MAX(fechaaud) AS fechaaud                                              FROM bddldes.ktoa41t_union A                                              GROUP BY                                                     CDNUMREC,CDNUMPOL,CTVRSPOL,FECONTAB,FECMVTO,NUSECMVO,CDINTERC,TCCDMONE,NUTRAB,                                                   FECTRAB,INRECIFR,INDEMIAN                                         )PARC2                                         ON(PARC.CDNUMREC = PARC2.CDNUMREC  AND                                             PARC.CDNUMPOL = PARC2.CDNUMPOL  AND                                              PARC.CTVRSPOL = PARC2.CTVRSPOL AND                                            PARC.FECONTAB = PARC2.FECONTAB  AND                                            PARC.FECMVTO  = PARC2.FECMVTO   AND                                                PARC.NUSECMVO = PARC2.NUSECMVO  AND                                             PARC.CDINTERC = PARC2.CDINTERC  AND                                               PARC.TCCDMONE = PARC2.TCCDMONE  AND                                             PARC.NUTRAB   = PARC2.NUTRAB    AND                                                PARC.FECTRAB  = PARC2.FECTRAB   AND                                               PARC.INRECIFR = PARC2.INRECIFR  AND                                             PARC.INDEMIAN = PARC2.INDEMIAN  AND                                            PARC.fechaaud = PARC2.fechaaud                                         )                                     WHERE PARC2.fechaaud IS NOT NULL                      /* CODIGO COMPANIA GRUPO */                                 ) CABPRP                             GROUP BY                                 CDNUMPOL, CTVRSPOL, CDCIAGRU,  FECONTAB, NUSECMVO, NUTRAB, CDNUMREC, INRECIFR, INDEMIAN, FEPRECON,                                 TCCDMONE, FEPROMEC, CDINTERC, FECMVTO, FECTRAB, CDREFCAB,  SUBSTR(TRIM(CDREFCAB),7,2)                     ) A2                     ON ( TRIM(A.CDCIAGRU)  = TRIM(A2.CDCIAGRU) AND                         A.CDNUMREC  = A2.CDNUMREC AND                         A.CDNUMPOL  = A2.CDNUMPOL AND                         A.CTVRSPOL  = A2.CTVRSPOL AND                         A.FECONTAB  = A2.FECONTAB AND                         A.FECMVTO   = A2.FECMVTO  AND                         A.NUSECMVO  = A2.NUSECMVO AND                         A.CDINTERC  = A2.CDINTERC AND                         A.TCCDMONE  = A2.TCCDMONE AND                         A.NUTRAB    = A2.NUTRAB   AND                         A.FECTRAB   = A2.FECTRAB  AND                         A.INRECIFR  = A2.INRECIFR AND                         A.INDEMIAN  = A2.INDEMIAN                         )             ) B              -- TIPO DE CAMBIO             LEFT OUTER JOIN (                             SELECT DISTINCT A.CDDIVDES, A.CDDIVORI, A.FECAMBIO, A.VATIPCAV,                                      CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP ) AS FECAMBIO_FCH                                      FROM BDDLCRU.KTOTCAT A                                      INNER JOIN                                      (                                      SELECT CDDIVDES, CDDIVORI, MAX(CTVRSCAM) AS MAX_CTVRSCAM, FECAMBIO                                      FROM BDDLCRU.KTOTCAT GROUP BY CDDIVDES, CDDIVORI, FECAMBIO                                      ) B                                      ON (A.CDDIVDES = B.CDDIVDES AND A.CTVRSCAM = B.MAX_CTVRSCAM                                         AND  A.CDDIVORI = B.CDDIVORI AND A.FECAMBIO = B.FECAMBIO)                                      WHERE A.FECAMBIO > 0             ) TC             ON (TC.CDDIVORI = B.TCCDMONE AND TC.FECAMBIO_FCH = B.FECONTAB_FH)             LEFT OUTER JOIN (                              SELECT DISTINCT A.CDDIVDES, A.CDDIVORI, A.FECAMBIO, A.VATIPCAV,                                      CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP ) AS FECAMBIO_FCH                                      FROM BDDLCRU.KTOTCAT A                                      INNER JOIN                                      (                                      SELECT CDDIVDES, CDDIVORI, MAX(CTVRSCAM) AS MAX_CTVRSCAM, FECAMBIO                                      FROM BDDLCRU.KTOTCAT GROUP BY CDDIVDES, CDDIVORI, FECAMBIO                                      ) B                                      ON (A.CDDIVDES = B.CDDIVDES AND A.CTVRSCAM = B.MAX_CTVRSCAM                                         AND  A.CDDIVORI = B.CDDIVORI AND A.FECAMBIO = B.FECAMBIO)                                      WHERE A.FECAMBIO > 0             ) TC2             ON (TC2.CDDIVORI = B.TCCDMONE AND TC2.FECAMBIO_FCH = DAYS_SUB(B.FECONTAB_FH,1))             --ON (TC2.CDDIVORI = B.TCCDMONE AND TC2.FECAMBIO_FCH =  (FECONTAB_FH-1 DAY))             LEFT OUTER JOIN (                              SELECT DISTINCT A.CDDIVDES, A.CDDIVORI, A.FECAMBIO, A.VATIPCAV,                                      CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP ) AS FECAMBIO_FCH                                      FROM BDDLCRU.KTOTCAT A                                      INNER JOIN                                      (                                      SELECT CDDIVDES, CDDIVORI, MAX(CTVRSCAM) AS MAX_CTVRSCAM, FECAMBIO                                      FROM BDDLCRU.KTOTCAT GROUP BY CDDIVDES, CDDIVORI, FECAMBIO                                      ) B                                  ",,,,,,,,,
   ON (A.CDDIVDES = B.CDDIVDES AND A.CTVRSCAM = B.MAX_CTVRSCAM,,,,,,,,,,,,,,,,,,,,,,,,
                                         AND  A.CDDIVORI = B.CDDIVORI AND A.FECAMBIO = B.FECAMBIO),,,,,,,,,,,,,,,,,,,,,,,,
                                      WHERE A.FECAMBIO > 0,,,,,,,,,,,,,,,,,,,,,,,,
             ) TC3,,,,,,,,,,,,,,,,,,,,,,,,
             ON (TC3.CDDIVORI = B.TCCDMONE AND TC3.FECAMBIO_FCH = DAYS_SUB(B.FECONTAB_FH,2)),,,,,,,,,,,,,,,,,,,,,,,
           --  ON (TC3.CDDIVORI = B.TCCDMONE AND TC3.FECAMBIO_FCH = (FECONTAB_FH-2 DAY)),,,,,,,,,,,,,,,,,,,,,,,,
             LEFT OUTER JOIN (,,,,,,,,,,,,,,,,,,,,,,,,
                              SELECT DISTINCT A.CDDIVDES, A.CDDIVORI, A.FECAMBIO, A.VATIPCAV,,,,,,,,,,,,,,,,,,,,,
                                      CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP ) AS FECAMBIO_FCH,,,,,,,,,,,,,,
                                      FROM BDDLCRU.KTOTCAT A,,,,,,,,,,,,,,,,,,,,,,,,
                                      INNER JOIN,,,,,,,,,,,,,,,,,,,,,,,,
                                      (,,,,,,,,,,,,,,,,,,,,,,,,
                                      SELECT CDDIVDES, CDDIVORI, MAX(CTVRSCAM) AS MAX_CTVRSCAM, FECAMBIO,,,,,,,,,,,,,,,,,,,,,
                                      FROM BDDLCRU.KTOTCAT GROUP BY CDDIVDES, CDDIVORI, FECAMBIO,,,,,,,,,,,,,,,,,,,,,,
                                      ) B,,,,,,,,,,,,,,,,,,,,,,,,
                                      ON (A.CDDIVDES = B.CDDIVDES AND A.CTVRSCAM = B.MAX_CTVRSCAM,,,,,,,,,,,,,,,,,,,,,,,,
                                         AND  A.CDDIVORI = B.CDDIVORI AND A.FECAMBIO = B.FECAMBIO),,,,,,,,,,,,,,,,,,,,,,,,
                                      WHERE A.FECAMBIO > 0,,,,,,,,,,,,,,,,,,,,,,,,
             ) TC4,,,,,,,,,,,,,,,,,,,,,,,,
             ON (TC4.CDDIVORI = B.TCCDMONE AND TC4.FECAMBIO_FCH = DAYS_SUB(B.FECONTAB_FH,3)),,,,,,,,,,,,,,,,,,,,,,,
           --  ON (TC4.CDDIVORI = B.TCCDMONE AND TC4.FECAMBIO_FCH = (FECONTAB_FH-3 DAY)),,,,,,,,,,,,,,,,,,,,,,,,
             LEFT OUTER JOIN (,,,,,,,,,,,,,,,,,,,,,,,,
                              SELECT DISTINCT A.CDDIVDES, A.CDDIVORI, A.FECAMBIO, A.VATIPCAV,,,,,,,,,,,,,,,,,,,,,
                                      CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP ) AS FECAMBIO_FCH,,,,,,,,,,,,,,
                                      FROM BDDLCRU.KTOTCAT A,,,,,,,,,,,,,,,,,,,,,,,,
                                      INNER JOIN,,,,,,,,,,,,,,,,,,,,,,,,
                                      (,,,,,,,,,,,,,,,,,,,,,,,,
                                      SELECT CDDIVDES, CDDIVORI, MAX(CTVRSCAM) AS MAX_CTVRSCAM, FECAMBIO,,,,,,,,,,,,,,,,,,,,,
                                      FROM BDDLCRU.KTOTCAT GROUP BY CDDIVDES, CDDIVORI, FECAMBIO,,,,,,,,,,,,,,,,,,,,,,
                                      ) B,,,,,,,,,,,,,,,,,,,,,,,,
                                      ON (A.CDDIVDES = B.CDDIVDES AND A.CTVRSCAM = B.MAX_CTVRSCAM,,,,,,,,,,,,,,,,,,,,,,,,
                                         AND  A.CDDIVORI = B.CDDIVORI AND A.FECAMBIO = B.FECAMBIO),,,,,,,,,,,,,,,,,,,,,,,,
                                      WHERE A.FECAMBIO > 0,,,,,,,,,,,,,,,,,,,,,,,,
             ) TC5,,,,,,,,,,,,,,,,,,,,,,,,
             ON (TC5.CDDIVORI = B.TCCDMONE AND TC5.FECAMBIO_FCH = DAYS_SUB(B.FECONTAB_FH,4)),,,,,,,,,,,,,,,,,,,,,,,
           --  ON (TC5.CDDIVORI = B.TCCDMONE AND TC5.FECAMBIO_FCH = (FECONTAB_FH-4 DAY)),,,,,,,,,,,,,,,,,,,,,,,,
             LEFT OUTER JOIN (,,,,,,,,,,,,,,,,,,,,,,,,
                              SELECT DISTINCT A.CDDIVDES, A.CDDIVORI, A.FECAMBIO, A.VATIPCAV,,,,,,,,,,,,,,,,,,,,,
                                      CAST(CONCAT(SUBSTR(CAST (A.FECAMBIO AS STRING),1,4),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),5,2),'-',SUBSTR(CAST (A.FECAMBIO AS STRING),7,2)) AS TIMESTAMP ) AS FECAMBIO_FCH,,,,,,,,,,,,,,
                                      FROM BDDLCRU.KTOTCAT A,,,,,,,,,,,,,,,,,,,,,,,,
                                      INNER JOIN,,,,,,,,,,,,,,,,,,,,,,,,
                                      (,,,,,,,,,,,,,,,,,,,,,,,,
                                      SELECT CDDIVDES, CDDIVORI, MAX(CTVRSCAM) AS MAX_CTVRSCAM, FECAMBIO,,,,,,,,,,,,,,,,,,,,,
                                      FROM BDDLCRU.KTOTCAT GROUP BY CDDIVDES, CDDIVORI, FECAMBIO,,,,,,,,,,,,,,,,,,,,,,
                                      ) B,,,,,,,,,,,,,,,,,,,,,,,,
                                      ON (A.CDDIVDES = B.CDDIVDES AND A.CTVRSCAM = B.MAX_CTVRSCAM,,,,,,,,,,,,,,,,,,,,,,,,
                                         AND  A.CDDIVORI = B.CDDIVORI AND A.FECAMBIO = B.FECAMBIO),,,,,,,,,,,,,,,,,,,,,,,,
                                      WHERE A.FECAMBIO > 0,,,,,,,,,,,,,,,,,,,,,,,,
             ) TC6,,,,,,,,,,,,,,,,,,,,,,,,
             ON (TC6.CDDIVORI = B.TCCDMONE AND TC6.FECAMBIO_FCH = DAYS_SUB(B.FECONTAB_FH,5)),,,,,,,,,,,,,,,,,,,,,,,
         ) C,,,,,,,,,,,,,,,,,,,,,,,,
         GROUP BY,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDNUMPOL,,,,,,,,,,,,,,,,,,,,,,,,
             C.CTVRSPOL,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDOBJTP,,,,,,,,,,,,,,,,,,,,,,,,
             C.CTSECOBJ,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDNUMREC,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
             C.CDPRODTE,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDPRODCO,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDRAMDGS,,,,,,,,,,,,,,,,,,,,,,,,
          -- C.NUAPUNTE,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
             C.TCTINEGO,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDMEDPAG,,,,,,,,,,,,,,,,,,,,,,,,
          -- C.INFISMOR,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
             C.CLFILTOM,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDFILPAG,,,,,,,,,,,,,,,,,,,,,,,,
             C.TCTITXCT,,,,,,,,,,,,,,,,,,,,,,,,
             C.TCCOPERA,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDMCT,,,,,,,,,,,,,,,,,,,,,,,,
             C.TCCDMONE,,,,,,,,,,,,,,,,,,,,,,,,
             C.CABECERA,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000,,,,,,,,,,,,,,,,,,,,,,,
             C.CDREFCAB,     ---  <--- AGREGADO PARA LA BUSQUEDA DE LA DIFERENCIA DE LOS 12000,,,,,,,,,,,,,,,,,,,,,,,
             C.TIPCAVT,,,,,,,,,,,,,,,,,,,,,,,,
             C.FECONTAB,,,,,,,,,,,,,,,,,,,,,,,,
             C.FECONTAB_FH,,,,,,,,,,,,,,,,,,,,,,,,
             C.EJERCICIO,,,,,,,,,,,,,,,,,,,,,,,,
             C.PERIODO,,,,,,,,,,,,,,,,,,,,,,,,
             C.DIA,,,,,,,,,,,,,,,,,,,,,,,,
             C.ANIOMES,,,,,,,,,,,,,,,,,,,,,,,,
             C.IND_TIPO_PRIMA,,,,,,,,,,,,,,,,,,,,,,,,
             C.CDOPERA,,,,,,,,,,,,,,,,,,,,,,,,
         --  C.INRECIFR,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CLPROTI,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CLPROUN,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CDESTRUG,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CLGESTI,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CLGESUN,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.FECMVTO_FH,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.FECAMBIO_FH,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.FECTRAB_FH,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.FEPROMEC_FH,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.TCDOMORI,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.NUSECMVO,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.INDEMIAN,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.NUTRAB,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CDINTERC,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
         --  C.CDESTRUP,#¿NOMBRE?,,,,,,,,,,,,,,,,,,,,,,,
             C.TABORI,,,,,,,,,,,,,,,,,,,,,,,,
             C.SISTORIG,,,,,,,,,,,,,,,,,,,,,,,,
"     ) E""",,SELECT,4e4fbeeea26cff39:b1017bca00000000,ea45e81a4bdab095:6e358fa57dd055b1,"Query 4e4fbeeea26cff39:b1017bca00000000 expired due to client inactivity (timeout is 10m)
",bddlcru,TABLE,,ktotcat,,,,,,,,,,,,,,,
2019-11-21T20:42:12.000Z,,10.67.59.12,impala,QUERY,null:null,true,,,,,,,,,GET_COLUMNS,,,c042f37b0b10b410:b48fd72200000000,7a41cac1278b5589:ce7ac8f1daccf7a5,,,,,
2019-11-21T20:41:02.584Z,user_gmm,10.67.59.12,hive,QUERY,:,true,,,,,,,,,"        select * 
          from bddlcru.cat_estatus_poliza",,,,,,,DFS_DIR,/tmp/hive/user_gmm/2c12ff5b-f4c5-43b3-8125-5256b7aa413d/hive_2019-11-21_14-41-02_595_1197130119974790671-92239/-mr-10000,
2019-11-21T20:41:02.584Z,user_gmm,10.67.59.12,hive,QUERY,bddlcru:cat_estatus_poliza,true,,,,,,,,,"        select * 
          from bddlcru.cat_estatus_poliza",,,,,,bddlcru,TABLE,/entrada/crud/eot/CAT_ESTATUS_POLIZA,cat_estatus_poliza
